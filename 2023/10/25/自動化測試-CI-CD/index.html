<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>自動化測試 CI/CD | Nalson</title><meta name="author" content="Nalson Lai"><meta name="copyright" content="Nalson Lai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 CI&#x2F;CD 簡介CI&#x2F;CD 其實是指兩個部分，分別是 Continuous Integration (持續整合) 以及 Continuous Deployment (持續部屬) CI 持續整合在軟體開發的過程中，通常會由無數個開發人員一起工作，然而隨著程式碼以及人數的增加，專案會越來越難進行整合，這個時候我們">
<meta property="og:type" content="article">
<meta property="og:title" content="自動化測試 CI&#x2F;CD">
<meta property="og:url" content="https://gahgah147.github.io/2023/10/25/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6-CI-CD/index.html">
<meta property="og:site_name" content="Nalson">
<meta property="og:description" content="這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 CI&#x2F;CD 簡介CI&#x2F;CD 其實是指兩個部分，分別是 Continuous Integration (持續整合) 以及 Continuous Deployment (持續部屬) CI 持續整合在軟體開發的過程中，通常會由無數個開發人員一起工作，然而隨著程式碼以及人數的增加，專案會越來越難進行整合，這個時候我們">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://gahgah147.github.io/img/catchorange.png">
<meta property="article:published_time" content="2023-10-25T05:57:45.000Z">
<meta property="article:modified_time" content="2024-10-29T03:54:51.444Z">
<meta property="article:author" content="Nalson Lai">
<meta property="article:tag" content="Pytest">
<meta property="article:tag" content="Selenium">
<meta property="article:tag" content="CI&#x2F;CD">
<meta property="article:tag" content="GitHub">
<meta property="article:tag" content="GitLab">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gahgah147.github.io/img/catchorange.png"><link rel="shortcut icon" href="/img/catchorange.png"><link rel="canonical" href="https://gahgah147.github.io/2023/10/25/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6-CI-CD/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.1.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到符合您查詢的內容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '複製成功',
    error: '複製失敗',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '載入更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '自動化測試 CI/CD',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-29 11:54:51'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Nalson" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Nalson" type="application/rss+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/catchorange.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">125</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">206</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 歸檔</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情連結</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-info"></i><span> 關於</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/back_img.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Nalson</span></a><a class="nav-page-title" href="/"><span class="site-name">自動化測試 CI/CD</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜尋</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 歸檔</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情連結</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-info"></i><span> 關於</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">自動化測試 CI/CD</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2023-10-25T05:57:45.000Z" title="發表於 2023-10-25 13:57:45">2023-10-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2024-10-29T03:54:51.444Z" title="更新於 2024-10-29 11:54:51">2024-10-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">瀏覽量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>這篇是記錄我在看鐵人賽 <a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10290529">Python 與自動化測試的敲門磚 </a> 的過程</p>
<h1 id="CI-CD-簡介"><a href="#CI-CD-簡介" class="headerlink" title="CI&#x2F;CD 簡介"></a>CI&#x2F;CD 簡介</h1><p>CI&#x2F;CD 其實是指兩個部分，分別是 Continuous Integration (持續整合) 以及 Continuous Deployment (持續部屬)</p>
<h2 id="CI-持續整合"><a href="#CI-持續整合" class="headerlink" title="CI 持續整合"></a>CI 持續整合</h2><p>在軟體開發的過程中，通常會由無數個開發人員一起工作，然而隨著程式碼以及人數的增加，專案會越來越難進行整合，這個時候我們就可以透過 CI 來進行。與其說 CI 是個工具，不如說 CI 是一種合作模式，藉由簡單的設定來讓 CI 工具替我們進行測試，就可以降低我們的專案在進行更新、整合時碰到問題的機率。</p>
<p>在 CI 執行的過程中，會建議每個開發人員每天上班前先做一次 pull 的動作，於每天下班前至少執行一次 push 的動作，以此確保 CI 的運行效率。</p>
<h2 id="CD-持續部屬"><a href="#CD-持續部屬" class="headerlink" title="CD 持續部屬"></a>CD 持續部屬</h2><p>每當我們透過 CI 將專案整合完成後，便可以透過 CD 來進行自動化的部屬，減少我們在測試與部屬之間所耗費的時間</p>
<h1 id="CI-CD-常用工具"><a href="#CI-CD-常用工具" class="headerlink" title="CI&#x2F;CD 常用工具"></a>CI&#x2F;CD 常用工具</h1><h2 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h2><p>於 GitLab 上提供了 CI&#x2F;CD 的介面，藉由在某處部屬好的 docker image，即可進行 CI&#x2F;CD，為目前主流的 CI&#x2F;CD 工具</p>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>GitHub 於 2019 年推出了 GitHub Actions，此工具可以協助我們進行 CI，不過由於此功能還算新，尚有許多功能不成熟，因此比較建議使用在小型專案的 CI 當中</p>
<h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><p>為目前主流的 CD 工具，藉由 GitLab 進行 CI 後，會將程式碼打包到 Jenkins 進行自動化部屬</p>
<h1 id="GitHub-設定"><a href="#GitHub-設定" class="headerlink" title="GitHub 設定"></a>GitHub 設定</h1><h2 id="建立-yml-file"><a href="#建立-yml-file" class="headerlink" title="建立 yml file"></a>建立 yml file</h2><p>進入 github 專案並點選 Actions 選項<br><img src="https://hackmd.io/_uploads/B1bGcmKlT.png"></p>
<p><img src="https://hackmd.io/_uploads/SynUsXKx6.png"></p>
<blockquote>
<p>需要點擊啟用 Actions 設定</p>
</blockquote>
<p><img src="https://hackmd.io/_uploads/B1Rqj7Fxp.png"><br>點擊 New Workflow</p>
<p>在 Workflows 欄位底下輸入 “python” 進行搜尋<br><img src="https://hackmd.io/_uploads/SJpG5Xte6.png"></p>
<p>選擇 Python Application，並點選 Configure 選項<br><img src="https://hackmd.io/_uploads/Bkum5mYxp.png"></p>
<p>將跳轉後出現的頁面的程式碼滑到最底下，並將 pytest 更改為 echo “hello”</p>
<p>點選右上方 “Start Commit” 選項<br><img src="https://hackmd.io/_uploads/BkD4qQtla.png"></p>
<p>點選 “Commit new file” 選項<br><img src="https://hackmd.io/_uploads/HycBcXYep.png"></p>
<div class="note info simple"><p>測試若有設定過會出錯，需要新建立一個repository才會成功</p>
</div>

<p>頁面會自動跳轉回專案首頁，請點選回 “Actions”，就可以看到 github 按照剛剛建立的檔案建立了一個 CI 任務</p>
<p><img src="https://hackmd.io/_uploads/HyOv9QKlT.png"></p>
<p>點進此任務，並選擇 build 選項<br><img src="https://hackmd.io/_uploads/Bk-uqQFla.png"></p>
<p>點選 “Test with pytest” 部分即可看到剛剛修改的 echo “hello”<br><img src="https://hackmd.io/_uploads/S10t27tgp.png"></p>
<p><img src="https://hackmd.io/_uploads/HJ2O9XYlp.png"></p>
<h2 id="修改-yml"><a href="#修改-yml" class="headerlink" title="修改 yml"></a>修改 yml</h2><p>由於我們剛剛是直接在 github 上進行 commit 來新增 workflows，因此我們要先回到專案上執行 git pull 確保專案同步</p>
<p>執行完 git pull 後即可在專案上看到 “.github” 這個目錄，並且有 “workflows” 這個子目錄</p>
<p>“workflows” 目錄下會有一個 python-app.yml 檔案，這個就是我們等一下要修改的檔案</p>
<p><img src="https://hackmd.io/_uploads/rJ-s9mYxp.png"></p>
<p>在修改 yml 前我們先建立幾個簡單的 test case 並存放到 day_22&#x2F;test_demo.py 目錄下<br><img src="https://hackmd.io/_uploads/Byso9XKx6.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def test_export_report_1():</span><br><span class="line">    a = 1 + 1</span><br><span class="line">    b = 2 + 2</span><br><span class="line"></span><br><span class="line">    assert b &gt; a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_export_report_2():</span><br><span class="line">  a = 2 + 2</span><br><span class="line">  b = 4 + 4</span><br><span class="line"></span><br><span class="line">  assert a &lt; b</span><br></pre></td></tr></table></figure>
<p>打開 python-app.yml</p>
<p>將剛剛的 echo “hello” 修改為 pytest -s -v .&#x2F;day_22&#x2F;test_demo.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># This workflow will install Python dependencies, run tests and lint with a single version of Python</span><br><span class="line"># For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions</span><br><span class="line"></span><br><span class="line">name: Python application</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line">    branches: [ &quot;master&quot; ]</span><br><span class="line">  pull_request:</span><br><span class="line">    branches: [ &quot;master&quot; ]</span><br><span class="line"></span><br><span class="line">permissions:</span><br><span class="line">  contents: read</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line">  build:</span><br><span class="line"></span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">    - uses: actions/checkout@v3</span><br><span class="line">    - name: Set up Python 3.10</span><br><span class="line">      uses: actions/setup-python@v3</span><br><span class="line">      with:</span><br><span class="line">        python-version: &quot;3.10&quot;</span><br><span class="line">    - name: Install dependencies</span><br><span class="line">      run: |</span><br><span class="line">        python -m pip install --upgrade pip</span><br><span class="line">        pip install flake8 pytest</span><br><span class="line">        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span><br><span class="line">    - name: Lint with flake8</span><br><span class="line">      run: |</span><br><span class="line">        # stop the build if there are Python syntax errors or undefined names</span><br><span class="line">        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics</span><br><span class="line">        # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide</span><br><span class="line">        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics</span><br><span class="line">    - name: Test with pytest</span><br><span class="line">      run: |</span><br><span class="line">        pytest -s -v ./day_22/test_demo.py</span><br></pre></td></tr></table></figure>

<h2 id="察看結果"><a href="#察看結果" class="headerlink" title="察看結果"></a>察看結果</h2><p>修改完成後，我們就可以將整個專案 push 到 Github 上，這個時候我們就可以回到剛剛的 “Actions” 頁面察看結果了</p>
<p>下圖中我們可以看到 Acitons 這邊多了一個任務，任務名稱會使用剛剛的 commit message 命名<br><img src="https://hackmd.io/_uploads/HkdxiQKxT.png"></p>
<p>點進去該任務後就可以查看 pytest 的執行結果了<br><img src="https://hackmd.io/_uploads/ryZWjQtgT.png"></p>
<h2 id="python-app-yml"><a href="#python-app-yml" class="headerlink" title="python-app.yml"></a>python-app.yml</h2><h3 id="運行於指定的-branch-上"><a href="#運行於指定的-branch-上" class="headerlink" title="運行於指定的 branch 上"></a>運行於指定的 branch 上</h3><p>我們可以透過 on 參數來設定當哪個 branch 被推上 Github 上時要進行 CI 的動作，由於 CI 的進行也是需要耗費一定的資源，因此不太可能讓所有瑣碎的 branch 被推上去時都自動進行一次，透過設定 branches 可以指定那些 branch 被推上來時要執行 CI</p>
<p>補充：可以看到 on 底下有分為 push 以及 pull_request 兩個層級，分別代表著 Github 上的兩種協作方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line">    branches: [ &quot;master&quot; ]</span><br><span class="line">  pull_request:</span><br><span class="line">    branches: [ &quot;master&quot; ]</span><br></pre></td></tr></table></figure>

<h3 id="建立-CI-任務"><a href="#建立-CI-任務" class="headerlink" title="建立 CI 任務"></a>建立 CI 任務</h3><table>
<thead>
<tr>
<th>變數</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>runs-on</td>
<td>為 CI 執行時最底下的一個 docker image 名稱，設定完成後 CI 會於執行時使用該 image 建立環境</td>
</tr>
<tr>
<td>steps</td>
<td>為實際 CI 執行的細項，每一個細項開頭都會使用 “-“ 來表示</td>
</tr>
<tr>
<td>uses</td>
<td>為為運行此 steps 時啟動的服務，為 docker image 名稱</td>
</tr>
<tr>
<td>name</td>
<td>為此 step 的名稱</td>
</tr>
<tr>
<td>run</td>
<td>為此 step 要執行的命令</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build:</span><br><span class="line"></span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">    - uses: actions/checkout@v3</span><br><span class="line">      </span><br><span class="line">    - name: Set up Python 3.10</span><br><span class="line">      uses: actions/setup-python@v3</span><br><span class="line">      with:</span><br><span class="line">        python-version: &quot;3.10&quot;</span><br><span class="line">    </span><br><span class="line">    - name: Test with pytest</span><br><span class="line">      run: |</span><br><span class="line">        pytest -s -v ./day_22/test_demo.py</span><br></pre></td></tr></table></figure>


<h1 id="GitLab-設定"><a href="#GitLab-設定" class="headerlink" title="GitLab 設定"></a>GitLab 設定</h1><h2 id="建立-CI-CD-runner"><a href="#建立-CI-CD-runner" class="headerlink" title="建立 CI&#x2F;CD runner"></a>建立 CI&#x2F;CD runner</h2><p>在 GitLab 運行 CI&#x2F;CD 時，同樣需要一個 runner 在背後執行，只是在 GitHub 的時候，他們幫我們做好了，因此我們不需要去碰到這塊，下面的方法為建立 runner 並和 GitLab 上的專案綁定的方法</p>
<div class="note info simple"><p>接下來的步驟請先在要建立 runner 的電腦上安裝 docker</p>
</div>

<p>前往 GitLab 專案的 Setting 裡面的 CI&#x2F;CD 頁面</p>
<p><img src="https://hackmd.io/_uploads/HJPEL21Ma.png"></p>
<blockquote>
<p>Setting &gt; CI&#x2F;CD</p>
</blockquote>
<p><img src="https://hackmd.io/_uploads/SJwSU2yfT.png"></p>
<blockquote>
<p>找到 Runner 部分並打開，可以看到要和 runner 做連線的網址以及 token</p>
</blockquote>
<p>打開 terminal</p>
<p>建立 docker volume</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create gitlab-runner</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SJ1MO21fp.png"></p>
<p>啟動 docker 並將他連上剛剛建立的 volume</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name gitlab-runner --restart always -v /var/run/docker.sock:/var/run/docker.sock -v gitlab-runner:/etc/gitlab-runner gitlab/gitlab-runner:latest</span><br></pre></td></tr></table></figure>

<p>使用下方指令進行 runner 與 GitLab 的連線</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -it -v gitlab-runner:/etc/gitlab-runner gitlab/gitlab-runner:latest register</span><br></pre></td></tr></table></figure>

<p>接下來會開始進行註冊程序，我們會以一個問題搭配一個回答的方式撰寫</p>
<table>
<thead>
<tr>
<th>註冊程序</th>
<th>回答</th>
</tr>
</thead>
<tbody><tr>
<td>Enter the GitLab instance URL</td>
<td>寫上剛剛在 GitLab 上看到的 url</td>
</tr>
<tr>
<td>Enter the registration token</td>
<td>寫上剛剛在 GitLab 上看到的 token</td>
</tr>
<tr>
<td>Enter a description for the runner</td>
<td>寫上你想要為這個 runner 的描述，這邊使用 “nickchen1998_ithelp_2022_marathon”</td>
</tr>
<tr>
<td>Enter tags for the runner</td>
<td>為這個 runner 增加 tag，用來指派 CI&#x2F;CD 任務用，這邊先寫上 “nickchen1998_ithelp_2022_marathon”</td>
</tr>
<tr>
<td>Enter optional maintenance note for the runner</td>
<td>這部份我們不需要，直接按 Enter</td>
</tr>
<tr>
<td>Enter an executor</td>
<td>這邊我們輸入 “docker”，用來作為 runner 運行的環境</td>
</tr>
<tr>
<td>Enter the default Docker image</td>
<td>當 yaml 檔沒有指定要使用的 image 時，預設會使用的 image，這邊我們輸入 “python:latest”</td>
</tr>
</tbody></table>
<p>註冊完成</p>
<p><img src="https://hackmd.io/_uploads/By4VF3Jz6.png"></p>
<p><img src="https://hackmd.io/_uploads/rk4D5nkzT.png"></p>
<blockquote>
<p>回到剛剛的 runner 頁面，我們就可以看到一個新的 runner 被建立給這個專案</p>
</blockquote>
<h2 id="設定環境變數"><a href="#設定環境變數" class="headerlink" title="設定環境變數"></a>設定環境變數</h2><p>我們可以透過 Settings 內的 CI&#x2F;CD 頁面裡面的 Variables 欄位進行環境變數的設定</p>
<p><img src="https://hackmd.io/_uploads/HJsfs2yGp.png"></p>
<blockquote>
<p>Settings &gt; CI&#x2F;CD &gt; Variables</p>
</blockquote>
<p><img src="https://hackmd.io/_uploads/ryORi3yz6.png"></p>
<blockquote>
<p>點選 Add Variable 開始設定環境變數</p>
</blockquote>
<p><img src="https://hackmd.io/_uploads/r13x221zp.png"></p>
<blockquote>
<p>依序輸入 key、value 並點選 Add Variable</p>
</blockquote>
<p><img src="https://hackmd.io/_uploads/rJk7hnJza.png"></p>
<blockquote>
<p>可以看到成功新增的變數</p>
</blockquote>
<h2 id="設定-yaml-檔案"><a href="#設定-yaml-檔案" class="headerlink" title="設定 yaml 檔案"></a>設定 yaml 檔案</h2><h3 id="建立-gitlab-ci-yml"><a href="#建立-gitlab-ci-yml" class="headerlink" title="建立 .gitlab-ci.yml"></a>建立 .gitlab-ci.yml</h3><p>在整個專案的 “最外層” 建立 gitlab-ci.yml 檔案</p>
<h3 id="建立流程"><a href="#建立流程" class="headerlink" title="建立流程"></a>建立流程</h3><p>直接將工作名稱寫在最外層，並於其下一層利用 stage 表示此工作階段的名稱</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execute-test:</span><br><span class="line">  stage: test</span><br></pre></td></tr></table></figure>

<p>將要執行的指令依序寫在 scripts 後方</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">execute-test:</span><br><span class="line">  stage: test</span><br><span class="line">  script:</span><br><span class="line">    - pip3 install pytest</span><br><span class="line">    - pytest -s -v ./day_25/test_demo.py</span><br></pre></td></tr></table></figure>

<p>最後利用 tag 指定我們要執行這個任務的 runner (昨天文章有提到該如何建立 runner)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">execute-test:</span><br><span class="line">stage: test</span><br><span class="line">script:</span><br><span class="line">  - pip3 install pytest</span><br><span class="line">  - pytest -s -v ./day_25/test_demo.py</span><br><span class="line">tags:</span><br><span class="line">  - nickchen1998_ithelp_2022_marathon</span><br></pre></td></tr></table></figure>

<h3 id="管理-stage"><a href="#管理-stage" class="headerlink" title="管理 stage"></a>管理 stage</h3><p>透過設定 stage 可以來管理我們要執行哪個部份的腳本</p>
<p>透過下面這段程式碼，我們就成功設定執行所有 stage 為 test 的任務了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">execute-test:</span><br><span class="line">  stage: test</span><br><span class="line">  script:</span><br><span class="line">    - pip3 install pytest</span><br><span class="line">    - pytest -s -v ./day_25/test_demo.py</span><br><span class="line">  tags:</span><br><span class="line">    - nickchen1998_ithelp_2022_marathon</span><br></pre></td></tr></table></figure>

<h3 id="成果展示"><a href="#成果展示" class="headerlink" title="成果展示"></a>成果展示</h3><p>可以看到下圖中 GitLab 順利為我們生成一條 CI pipline<br><img src="https://hackmd.io/_uploads/ryHR33Vfa.png"></p>
<div class="note warning simple"><p>這邊要注意 runner 要指定對並且是執行中才會成功，不然會 Pending</p>
</div>

<p><img src="https://hackmd.io/_uploads/B1IbpnEMT.png"></p>
<h2 id="Selenium-設定"><a href="#Selenium-設定" class="headerlink" title="Selenium 設定"></a>Selenium 設定</h2><h3 id="修改-gitlab-ci-yml-設定檔案"><a href="#修改-gitlab-ci-yml-設定檔案" class="headerlink" title="修改 .gitlab-ci.yml 設定檔案"></a>修改 .gitlab-ci.yml 設定檔案</h3><p>首先我們要替我們的 .gitlab-ci.yml 加上 service 表示我們要在指定的任務中運行其他服務</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">execute-test:</span><br><span class="line">  stage: test</span><br><span class="line"></span><br><span class="line">  services:</span><br><span class="line"></span><br><span class="line">  script:</span><br><span class="line">    - pip3 install -r ./requirements.txt</span><br><span class="line">    - pytest -s -v ./day_26/test_demo.py</span><br><span class="line">  tags:</span><br><span class="line">    - nickchen1998_ithelp_2022_marathon</span><br></pre></td></tr></table></figure>

<p>接著透過設定 services 底下的 name 參數來指定我們要使用哪個 docker image，我們會需要使用到 selenium&#x2F;standalone-chrome 這個 image 來替我們建立一個可以遠端執行 Chrome 的環境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">execute-test:</span><br><span class="line">  stage: test</span><br><span class="line"></span><br><span class="line">  services:</span><br><span class="line">    - name: selenium/standalone-chrome</span><br><span class="line"></span><br><span class="line">  script:</span><br><span class="line">    - pip3 install -r ./requirements.txt</span><br><span class="line">    - pytest -s -v ./day_26/test_demo.py</span><br><span class="line">  tags:</span><br><span class="line">    - nickchen1998_ithelp_2022_marathon</span><br></pre></td></tr></table></figure>

<p>最後透過設定 alias 參數來為這個 services 進行命名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">execute-test:</span><br><span class="line">  stage: test</span><br><span class="line"></span><br><span class="line">  services:</span><br><span class="line">    - name: selenium/standalone-chrome</span><br><span class="line">      alias: CICD_Selenium</span><br><span class="line"></span><br><span class="line">  script:</span><br><span class="line">    - pip3 install -r ./requirements.txt</span><br><span class="line">    - pytest -s -v ./day_26/test_demo.py</span><br><span class="line">  tags:</span><br><span class="line">    - nickchen1998_ithelp_2022_marathon</span><br></pre></td></tr></table></figure>

<div class="note info simple"><p>script 方面我有實際測試，<br>pip3 install -r .&#x2F;requirements.txt<br>這行實際運行會出錯，我後來調整成這樣可以運行成功</p>
<p>script:<br>    - pip3 install pytest<br>    - pip3 install selenium<br>    - pip3 install webdriver_manager<br>    - pytest -s -v .&#x2F;day_26&#x2F;test_demo.py</p>
</div>

<h3 id="建立-fixture"><a href="#建立-fixture" class="headerlink" title="建立 fixture"></a>建立 fixture</h3><p>建立一個 conftest.py 並將 driver 的 fixture 寫在裡面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import pytest</span><br><span class="line">from typing import Union</span><br><span class="line">from selenium.webdriver import Remote, Chrome</span><br><span class="line">from selenium.webdriver.chrome.options import Options</span><br><span class="line">from webdriver_manager.chrome import ChromeDriverManager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;driver&quot;)</span><br><span class="line">def driver_fixture() -&gt; Union[Remote, Chrome]:</span><br><span class="line">    options = Options()</span><br><span class="line">    options.add_argument(&quot;--headless&quot;)</span><br><span class="line">    options.add_argument(f&quot;user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) &quot;</span><br><span class="line">                         f&quot;AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot;)</span><br><span class="line"></span><br><span class="line">    if sys.platform == &quot;win32&quot;:</span><br><span class="line">        driver = Chrome(ChromeDriverManager().install(),</span><br><span class="line">                        options=options)</span><br><span class="line">    else:</span><br><span class="line">        driver = Remote(command_executor=&quot;http://CICD_Selenium:4444/wd/hub&quot;,</span><br><span class="line">                        options=options)</span><br><span class="line"></span><br><span class="line">    yield driver</span><br><span class="line"></span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>

<h3 id="撰寫測試程式"><a href="#撰寫測試程式" class="headerlink" title="撰寫測試程式"></a>撰寫測試程式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver import Remote, Chrome</span><br><span class="line">from typing import Union</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_current_url(driver: Union[Remote, Chrome]):</span><br><span class="line">    driver.get(&quot;https://ithelp.ithome.com.tw/&quot;)</span><br><span class="line"></span><br><span class="line">    correct_url = &quot;https://ithelp.ithome.com.tw/&quot;</span><br><span class="line">    assert driver.current_url == correct_url</span><br><span class="line"></span><br><span class="line">    correct_title_start = &quot;iT 邦幫忙&quot;</span><br><span class="line">    assert driver.title.startswith(correct_title_start)</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://gahgah147.github.io">Nalson Lai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章連結: </span><span class="post-copyright-info"><a href="https://gahgah147.github.io/2023/10/25/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6-CI-CD/">https://gahgah147.github.io/2023/10/25/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6-CI-CD/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版權聲明: </span><span class="post-copyright-info">本部落格所有文章除特別聲明外，均採用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 授權協議。轉載請註明來源 <a href="https://gahgah147.github.io" target="_blank">Nalson</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Pytest/">Pytest</a><a class="post-meta__tags" href="/tags/Selenium/">Selenium</a><a class="post-meta__tags" href="/tags/CI-CD/">CI/CD</a><a class="post-meta__tags" href="/tags/GitHub/">GitHub</a><a class="post-meta__tags" href="/tags/GitLab/">GitLab</a></div><div class="post-share"><div class="social-share" data-image="/img/catchorange.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/10/26/Pytest-%E8%88%87-Mock/" title="Pytest 與 Mock"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Pytest 與 Mock</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 專案練習有同步到 github 上，可以前往 這個網址 pytest-mock 使用情境今天我們要說明該如何再進行測試時，把不想要執行的方法給替換掉，在測試的過程中，有時候只是要測試函式的可用性，但像是發送 email、撰寫檔案等等的函式，往往是不希望被執行的，總不能每執行一次測試就寄一封 mail 給你，這樣信箱會很快就爆炸的，針對這個情況我們就可以透過 pytest-mock 來替我們進行函式的抽換，並回傳假的資料，只要確認函式運行的流程是正確的即可 套件安裝1pip install pytest-mock  抽換屬性建立函式 demo.py建立一個透過 sys 取得 platform 的函式 123456import sysdef get_sys_platform():    platform = sys.platform    return platform  建立測試函式 test_demo.py將會用到的 package 全部 import 近來直接在 test case 當中的參數部分打上...</div></div></div></a><a class="pagination-related" href="/2023/10/18/Linux-%E8%A4%87%E8%A3%BD%E6%AA%94%E6%A1%88-cp-%E6%8C%87%E4%BB%A4/" title="Linux 複製檔案 cp 指令"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Linux 複製檔案 cp 指令</div></div><div class="info-2"><div class="info-item-1">複製檔案若要將 source.txt 檔案複製一份到 dest.txt，可以執行： 12# 將 source.txt 複製到 dest.txtcp source.txt dest.txt 複製目錄如果要複製整個目錄以及該目錄下的所有子目錄與檔案，可以加上 -r 參數（或是 -R、–recursive 參數亦可），以遞迴的方式進行複製： 12# 將 myfolder 目錄複製到 /path/to/ 路徑下cp -r myfolder /path/to/ 強制覆蓋檔案如果希望 cp 指令在無法寫入目的檔案時，嘗試刪除目的檔案，再重新複製一份新的檔案，可以加上 -f 或 –force 參數： 1cp -f source.txt dest.txt  不要覆蓋既有檔案如果希望 cp 指令遇到目的檔案已經存在的狀況，不要覆蓋既有的檔案，可以加上 -n 或 –no-clobber 參數： 1cp -n source.txt dest.txt  自動備份檔案若希望 cp 指令在覆蓋檔案時，可以將舊檔案自動備份起來，可以加上 -b 或 –backup 參數： 1cp -b source.txt...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相關推薦</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/10/27/Pytest-%E5%AE%A2%E8%A3%BD%E5%8C%96/" title="Pytest 客製化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-27</div><div class="info-item-2">Pytest 客製化</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 透過設定 pytest.ini 即可讓我們進行一些簡單的客製化，讓 pytest 更符合我們的需求 預設指令透過設定 pytest.ini 我們可以達到每次執行 pytest 時，會自動帶入指定的參數，例如：-s、-v …於整個專案最外層建立 pytest.ini 檔案 編輯 pytest.ini 1234[pytest]addopts = --maxfail=1 -s -v  範例當中，我們設定了在使用 pytest 時會自動帶入 -s、-v 參數，並且設定當發生一次錯誤時就會停止測試 建立測試程式 12345678import pytestargvalues = [[1, 1, 2], [2, 2, 5], [3, 3, 7], [4, 4, 8]]@pytest.mark.parametrize(argnames=&#x27;num1, num2, result&#x27;, argvalues=argvalues)def test_add(num1: int, num2: int, result:...</div></div></div></a><a class="pagination-related" href="/2023/09/22/Pytest-%E8%87%AA%E5%8B%95%E6%B8%AC%E8%A9%A6/" title="Pytest 自動測試"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-22</div><div class="info-item-2">Pytest 自動測試</div></div><div class="info-2"><div class="info-item-1">Pytest 指令1pytest &lt;.py 檔案位置&gt; 範例：pytest .\day_03\test_demo.py 參數執行1.列出每個 test case 的執行狀況 1pytest -v &lt;目錄 or 檔案位置&gt;  2.會印出在 test case 內有 print 出來的數值 1pytest -s &lt;目錄 or 檔案位置&gt;  3.不同的參數間，也可以進行混用，這邊進行簡單的範例展示 1pytest -s -v &lt;目錄 or 檔案位置&gt;：  產生報表產出 JSON 格式報表安裝 pytest-json-report 套件1pip install pytest-json-report   套件使用1pytest &lt;pytest 原生參數 ex: -s -v&gt; --json-report --json-report-file=&lt;檔案名稱 or ./目錄位置/檔案名稱&gt; &lt;要執行的 .py 檔案 (可省略直接對整個目錄做讀取)&gt; 使用範例：pytest -s -v –json-report...</div></div></div></a><a class="pagination-related" href="/2023/10/02/TDD-%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E6%B5%81%E7%A8%8B/" title="TDD 測試驅動開發流程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-02</div><div class="info-item-2">TDD 測試驅動開發流程</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 TDD 簡介TDD 全名為 Test-Driven Development 中文翻譯為 「測試驅動開發」，顧名思義就是藉著撰寫測試程式，來一步一步建構出我們的系統，其倡導的概念為，先撰寫測試程式，再撰寫實際相對應的 function，因此程式開發者需要先行和 PM 或使用者討論系統需求，並逐步擬定測試計畫，最後才會真正開始撰寫程式 採用 TDD 開發的優缺點    好處 壞處    無須事後再補寫測試程式 若系統需求溝通不良，會容易造成系統設計不良   每一位 RD 都可以透過測試程式了解每個 function 的內容，較容易熟悉系統 測試程式有很大的機率只有 RD 部門看得懂，需要花費多於成本溝通   可以確保每個 function 被更動時，可以馬上進行測試，降低錯誤產生    3A 原則在 TDD 當中，對於每個測試程式的撰寫有著 3A 原則 (步驟)，分別為 Arrange、Act 以及 Assert，下面按照順序來進行說明 下面這段程式碼是我們在 demo 3A...</div></div></div></a><a class="pagination-related" href="/2023/10/03/Selenium-%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6/" title="Selenium 自動化測試"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-03</div><div class="info-item-2">Selenium 自動化測試</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 套件安裝selenium：用來建立模擬器webdriver_manager：用來協助我們做驅動程式的安裝，可以無需實際下載瀏覽器的驅動程式 12pip install seleniumpip install webdriver_manager  快速入門程式解析： 透過 make_webdriver 內的程式碼，可以建立一個 Chrome 物件，習慣上我們會將此物件命名為 driver透過實作該方法得到 driver透過 driver.get() 對網址進行請求，這個時候 driver 就會實際替我們開啟一個瀏覽器為了展示開啟成功，使用 time.sleep() 讓瀏覽器畫面停止一下使用 driver.quit() 來確保瀏覽器完全關閉，不會殘留在記憶體當中 12345678910111213141516171819import timefrom selenium.webdriver import Chromefrom webdriver_manager.chrome import...</div></div></div></a><a class="pagination-related" href="/2024/01/17/%E4%BD%BF%E7%94%A8-Vercel-%E9%83%A8%E7%BD%B2-NestJS-%E7%A8%8B%E5%BC%8F/" title="使用 Vercel 部署 NestJS 程式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-17</div><div class="info-item-2">使用 Vercel 部署 NestJS 程式</div></div><div class="info-2"><div class="info-item-1">前言這邊我是參考這篇 一文教会你如何使用 Vercel 部署你的 NestJS 应用 教學文章跟著操作的紀錄 Nestjs 專案增加 vercel 設定文件在跟目錄下新增 vercel.json 文件 12345678910111213141516171819202122&#123;  &quot;version&quot;: 2,  &quot;builds&quot;: [    &#123;      &quot;src&quot;: &quot;src/main.ts&quot;,      &quot;use&quot;: &quot;@vercel/node&quot;    &#125;  ],  &quot;routes&quot;: [    &#123;      &quot;src&quot;: &quot;/(.*)&quot;,      &quot;dest&quot;: &quot;src/main.ts&quot;,      &quot;methods&quot;: [        &quot;GET&quot;,       ...</div></div></div></a><a class="pagination-related" href="/2023/09/12/%E5%9C%A8Codespace-%E4%B8%8A%E9%81%8B%E8%A1%8CPython/" title="在Codespace 上運行Python"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-12</div><div class="info-item-2">在Codespace 上運行Python</div></div><div class="info-2"><div class="info-item-1">在Codespace 上運行Python範例原始碼放在 GitHub Repo: vscode-remote-try-python 參考文章:Setting up a Python project for GitHub Codespaces 1. 在 codespace 上開啟 projectGo to https://github.com/microsoft/vscode-remote-try-python.Click Use this template, then    點擊 Open in a codespace.  2: 新增 dev container 設定檔案1.使用 Visual Studio Code 指令 (Ctrl+Shift+P&#x2F;Shift+Command+P)，然後輸入 add dev    點擊 Codespaces: Add Dev Container Configuration Files.   點擊 Create a new...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 評論</span></div><div class="comment-switch"><span class="first-comment">Valine</span><span id="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/catchorange.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Nalson Lai</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">125</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">206</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/gahgah147"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/gahgah147" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">在哪裡跌倒<br>就在哪裡躺好</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CI-CD-%E7%B0%A1%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">CI&#x2F;CD 簡介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CI-%E6%8C%81%E7%BA%8C%E6%95%B4%E5%90%88"><span class="toc-number">1.1.</span> <span class="toc-text">CI 持續整合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CD-%E6%8C%81%E7%BA%8C%E9%83%A8%E5%B1%AC"><span class="toc-number">1.2.</span> <span class="toc-text">CD 持續部屬</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CI-CD-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">2.</span> <span class="toc-text">CI&#x2F;CD 常用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab"><span class="toc-number">2.1.</span> <span class="toc-text">GitLab</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitHub"><span class="toc-number">2.2.</span> <span class="toc-text">GitHub</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins"><span class="toc-number">2.3.</span> <span class="toc-text">Jenkins</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GitHub-%E8%A8%AD%E5%AE%9A"><span class="toc-number">3.</span> <span class="toc-text">GitHub 設定</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-yml-file"><span class="toc-number">3.1.</span> <span class="toc-text">建立 yml file</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-yml"><span class="toc-number">3.2.</span> <span class="toc-text">修改 yml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%9F%E7%9C%8B%E7%B5%90%E6%9E%9C"><span class="toc-number">3.3.</span> <span class="toc-text">察看結果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python-app-yml"><span class="toc-number">3.4.</span> <span class="toc-text">python-app.yml</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%8B%E8%A1%8C%E6%96%BC%E6%8C%87%E5%AE%9A%E7%9A%84-branch-%E4%B8%8A"><span class="toc-number">3.4.1.</span> <span class="toc-text">運行於指定的 branch 上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-CI-%E4%BB%BB%E5%8B%99"><span class="toc-number">3.4.2.</span> <span class="toc-text">建立 CI 任務</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GitLab-%E8%A8%AD%E5%AE%9A"><span class="toc-number">4.</span> <span class="toc-text">GitLab 設定</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-CI-CD-runner"><span class="toc-number">4.1.</span> <span class="toc-text">建立 CI&#x2F;CD runner</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A8%AD%E5%AE%9A%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8"><span class="toc-number">4.2.</span> <span class="toc-text">設定環境變數</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A8%AD%E5%AE%9A-yaml-%E6%AA%94%E6%A1%88"><span class="toc-number">4.3.</span> <span class="toc-text">設定 yaml 檔案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-gitlab-ci-yml"><span class="toc-number">4.3.1.</span> <span class="toc-text">建立 .gitlab-ci.yml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%B5%81%E7%A8%8B"><span class="toc-number">4.3.2.</span> <span class="toc-text">建立流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86-stage"><span class="toc-number">4.3.3.</span> <span class="toc-text">管理 stage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">4.3.4.</span> <span class="toc-text">成果展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Selenium-%E8%A8%AD%E5%AE%9A"><span class="toc-number">4.4.</span> <span class="toc-text">Selenium 設定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-gitlab-ci-yml-%E8%A8%AD%E5%AE%9A%E6%AA%94%E6%A1%88"><span class="toc-number">4.4.1.</span> <span class="toc-text">修改 .gitlab-ci.yml 設定檔案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-fixture"><span class="toc-number">4.4.2.</span> <span class="toc-text">建立 fixture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%B0%E5%AF%AB%E6%B8%AC%E8%A9%A6%E7%A8%8B%E5%BC%8F"><span class="toc-number">4.4.3.</span> <span class="toc-text">撰寫測試程式</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/28/%E6%95%91%E7%94%9F%E5%93%A1%E6%8E%92%E7%8F%AD%E5%AA%92%E5%90%88-App-%E7%99%BC%E6%83%B3/" title="救生員排班媒合 App 發想">救生員排班媒合 App 發想</a><time datetime="2025-03-28T01:27:49.000Z" title="發表於 2025-03-28 09:27:49">2025-03-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/07/%E4%BD%BF%E7%94%A8%E6%A8%99%E6%BA%96-OIDC-%E5%AE%A2%E6%88%B6%E7%AB%AF%E9%80%A3%E6%8E%A5-Casdoor/" title="使用標準 OIDC 客戶端連接 Casdoor">使用標準 OIDC 客戶端連接 Casdoor</a><time datetime="2025-03-07T08:39:03.000Z" title="發表於 2025-03-07 16:39:03">2025-03-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/06/%E5%A6%82%E4%BD%95%E9%80%A3%E6%8E%A5%E5%88%B0-Casdoor/" title="如何連接到 Casdoor">如何連接到 Casdoor</a><time datetime="2025-03-06T09:20:52.000Z" title="發表於 2025-03-06 17:20:52">2025-03-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/05/%E5%9C%A8-Docker-desktop-%E4%B8%8A%E4%BD%BF%E7%94%A8-Kubernetes-Helm-%E9%83%A8%E7%BD%B2-Casdoor/" title="在 Docker desktop 上使用 Kubernetes Helm 部署 Casdoor">在 Docker desktop 上使用 Kubernetes Helm 部署 Casdoor</a><time datetime="2025-03-05T09:16:45.000Z" title="發表於 2025-03-05 17:16:45">2025-03-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/03/Casdoor-%E9%83%A8%E7%BD%B2%EF%BC%9A%E5%BE%9E%E5%AE%89%E8%A3%9D%E5%88%B0%E9%81%8B%E8%A1%8C%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B4%80%E9%8C%84/" title="Casdoor 部署：從安裝到運行的操作紀錄"><img src="https://hackmd.io/_uploads/ByJluhaqJl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Casdoor 部署：從安裝到運行的操作紀錄"/></a><div class="content"><a class="title" href="/2025/03/03/Casdoor-%E9%83%A8%E7%BD%B2%EF%BC%9A%E5%BE%9E%E5%AE%89%E8%A3%9D%E5%88%B0%E9%81%8B%E8%A1%8C%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B4%80%E9%8C%84/" title="Casdoor 部署：從安裝到運行的操作紀錄">Casdoor 部署：從安裝到運行的操作紀錄</a><time datetime="2025-03-03T02:33:44.000Z" title="發表於 2025-03-03 10:33:44">2025-03-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Nalson Lai</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主題 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日夜模式切換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往評論"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到頂端"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.1.0"></script><script src="/js/main.js?v=5.1.0"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.3.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine@1.5.2/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><script>(() => {
  const disqus_config = function () {
    this.page.url = 'https://gahgah147.github.io/2023/10/25/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6-CI-CD/'
    this.page.identifier = '/2023/10/25/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6-CI-CD/'
    this.page.title = '自動化測試 CI/CD'
  }

  const disqusReset = () => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addGlobalFn('themeChange', disqusReset, 'disqus')

  const loadDisqus = () =>{
    if (window.DISQUS) disqusReset()
    else {
      const script = document.createElement('script')
      script.src = 'https://.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if ('Valine' === 'Disqus' || !true) {
    if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      GLOBAL_CONFIG_SITE.isPost && getCount()
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜尋</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  資料載入中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜尋文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.1.0"></script></div></div></body></html>