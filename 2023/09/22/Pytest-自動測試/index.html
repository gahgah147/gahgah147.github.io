<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Pytest 自動測試 | Nalson</title><meta name="author" content="Nalson Lai"><meta name="copyright" content="Nalson Lai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pytest 指令1pytest &lt;.py 檔案位置&gt; 範例：pytest .\day_03\test_demo.py 參數執行1.列出每個 test case 的執行狀況 1pytest -v &lt;目錄 or 檔案位置&gt;  2.會印出在 test case 內有 print 出來的數值 1pytest -s &lt;目錄 or 檔案位置&gt;  3.不同的參數間，也可以進">
<meta property="og:type" content="article">
<meta property="og:title" content="Pytest 自動測試">
<meta property="og:url" content="https://gahgah147.github.io/2023/09/22/Pytest-%E8%87%AA%E5%8B%95%E6%B8%AC%E8%A9%A6/index.html">
<meta property="og:site_name" content="Nalson">
<meta property="og:description" content="Pytest 指令1pytest &lt;.py 檔案位置&gt; 範例：pytest .\day_03\test_demo.py 參數執行1.列出每個 test case 的執行狀況 1pytest -v &lt;目錄 or 檔案位置&gt;  2.會印出在 test case 內有 print 出來的數值 1pytest -s &lt;目錄 or 檔案位置&gt;  3.不同的參數間，也可以進">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://gahgah147.github.io/img/catchorange.png">
<meta property="article:published_time" content="2023-09-22T08:59:32.000Z">
<meta property="article:modified_time" content="2024-10-29T03:54:51.444Z">
<meta property="article:author" content="Nalson Lai">
<meta property="article:tag" content="Pytest">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="自動化測試">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gahgah147.github.io/img/catchorange.png"><link rel="shortcut icon" href="/img/catchorange.png"><link rel="canonical" href="https://gahgah147.github.io/2023/09/22/Pytest-%E8%87%AA%E5%8B%95%E6%B8%AC%E8%A9%A6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.1.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到符合您查詢的內容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '複製成功',
    error: '複製失敗',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '載入更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Pytest 自動測試',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-29 11:54:51'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Nalson" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Nalson" type="application/rss+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/catchorange.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">111</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">184</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 歸檔</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情連結</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-info"></i><span> 關於</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/back_img.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Nalson</span></a><a class="nav-page-title" href="/"><span class="site-name">Pytest 自動測試</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜尋</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 歸檔</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情連結</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-info"></i><span> 關於</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Pytest 自動測試</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2023-09-22T08:59:32.000Z" title="發表於 2023-09-22 16:59:32">2023-09-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2024-10-29T03:54:51.444Z" title="更新於 2024-10-29 11:54:51">2024-10-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">瀏覽量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Pytest-指令"><a href="#Pytest-指令" class="headerlink" title="Pytest 指令"></a>Pytest 指令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest &lt;.py 檔案位置&gt;</span><br></pre></td></tr></table></figure>
<p>範例：pytest .\day_03\test_demo.py</p>
<h2 id="參數執行"><a href="#參數執行" class="headerlink" title="參數執行"></a>參數執行</h2><p>1.列出每個 test case 的執行狀況</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -v &lt;目錄 or 檔案位置&gt;</span><br></pre></td></tr></table></figure>

<p>2.會印出在 test case 內有 print 出來的數值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -s &lt;目錄 or 檔案位置&gt;</span><br></pre></td></tr></table></figure>

<p>3.不同的參數間，也可以進行混用，這邊進行簡單的範例展示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -s -v &lt;目錄 or 檔案位置&gt;：</span><br></pre></td></tr></table></figure>

<h1 id="產生報表"><a href="#產生報表" class="headerlink" title="產生報表"></a>產生報表</h1><h2 id="產出-JSON-格式報表"><a href="#產出-JSON-格式報表" class="headerlink" title="產出 JSON 格式報表"></a>產出 JSON 格式報表</h2><h3 id="安裝-pytest-json-report-套件"><a href="#安裝-pytest-json-report-套件" class="headerlink" title="安裝 pytest-json-report 套件"></a>安裝 pytest-json-report 套件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest-json-report </span><br></pre></td></tr></table></figure>

<h3 id="套件使用"><a href="#套件使用" class="headerlink" title="套件使用"></a>套件使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest &lt;pytest 原生參數 ex: -s -v&gt; --json-report --json-report-file=&lt;檔案名稱 or ./目錄位置/檔案名稱&gt; &lt;要執行的 .py 檔案 (可省略直接對整個目錄做讀取)&gt;</span><br></pre></td></tr></table></figure>
<p>使用範例：pytest -s -v –json-report –json-report-file&#x3D;.\report\report.json .\test_demo.py</p>
<h3 id="報表結果解析"><a href="#報表結果解析" class="headerlink" title="報表結果解析"></a>報表結果解析</h3><table>
<thead>
<tr>
<th>Column 1</th>
<th>Column 2</th>
</tr>
</thead>
<tbody><tr>
<td>duration</td>
<td>本次測試執行所耗費的時間</td>
</tr>
<tr>
<td>root</td>
<td>從哪個目錄下 pytest 指令的</td>
</tr>
<tr>
<td>environment</td>
<td>一些環境的設定，例如 Python 版本</td>
</tr>
<tr>
<td>summary</td>
<td>測試結果總攬，collected 的部份表示 pytest 從 root 開始往下蒐集到多少個 test case</td>
</tr>
<tr>
<td>collectors</td>
<td>蒐集 test case 的過程</td>
</tr>
<tr>
<td>tests</td>
<td>測試的詳細結果，包含 setup、teardown 和 test case 本身的執行過程、時間</td>
</tr>
</tbody></table>
<h2 id="產出-HTML-報表"><a href="#產出-HTML-報表" class="headerlink" title="產出 HTML 報表"></a>產出 HTML 報表</h2><h3 id="安裝-pytest-html-套件"><a href="#安裝-pytest-html-套件" class="headerlink" title="安裝 pytest-html 套件"></a>安裝 pytest-html 套件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest-html</span><br></pre></td></tr></table></figure>
<h3 id="套件使用-1"><a href="#套件使用-1" class="headerlink" title="套件使用"></a>套件使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest --html=&lt;檔案名稱.html or .\目錄位置\檔案名稱.html&gt; &lt;執行的 .py 檔，省略會直接對整個目錄執行&gt;</span><br></pre></td></tr></table></figure>
<p>使用範例：pytest –html&#x3D;.\report\report.html .\test_demo.py</p>
<p><img src="https://hackmd.io/_uploads/r1hrz_F1p.png"></p>
<h2 id="Allure"><a href="#Allure" class="headerlink" title="Allure"></a>Allure</h2><h3 id="安裝-Java-JDK"><a href="#安裝-Java-JDK" class="headerlink" title="安裝 Java JDK"></a>安裝 Java JDK</h3><p>可參考這篇安裝 Java JDK<br><a target="_blank" rel="noopener" href="https://medium.com/@pierre.viara/install-java-on-windows-10-linux-subsystem-875f1f286ee8">https://medium.com/@pierre.viara/install-java-on-windows-10-linux-subsystem-875f1f286ee8</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SyTX8dF1p.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install openjdk-11-jdk</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/Hkbrv_Yyp.png"></p>
<p>可以用 java –version 確認是否安裝成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java --version</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SJqUvOY16.png"></p>
<h3 id="安裝-Allure"><a href="#安裝-Allure" class="headerlink" title="安裝 Allure"></a>安裝 Allure</h3><p>下載地址: <a target="_blank" rel="noopener" href="https://repo.maven.apache.org/maven2/io/qameta/allure/allure-commandline/">https://repo.maven.apache.org/maven2/io/qameta/allure/allure-commandline/</a></p>
<p>可以選擇適合的版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://repo.maven.apache.org/maven2/io/qameta/allure/allure-commandline/2.9.0/allure-commandline-2.9.0.tgz</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rJYSLtK1T.png"></p>
<p>解壓縮</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf allure-commandline-2.9.0.tgz</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SyiLIYtyp.png"></p>
<p>設定環境</p>
<p>進入解壓縮後的資料夾獲得絕對路徑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd allure-2.9.0/bin/</span><br><span class="line"></span><br><span class="line">pwd</span><br></pre></td></tr></table></figure>

<p>建立軟連結</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /home/user/allure-2.9.0/bin/allure /usr/bin/allure</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/SJ3BtFYk6.png"></p>
<blockquote>
<p>完成後輸入 allure –version 可以驗證是否安裝成功</p>
</blockquote>
<h3 id="安裝套件"><a href="#安裝套件" class="headerlink" title="安裝套件"></a>安裝套件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install allure-pytest</span><br></pre></td></tr></table></figure>

<h3 id="執行測試與生成報表"><a href="#執行測試與生成報表" class="headerlink" title="執行測試與生成報表"></a>執行測試與生成報表</h3><p>方法一<br>執行測試並產生 allure 暫存檔</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest &lt;測試檔案 or 目錄&gt; --alluredir &lt;allure 暫存檔存放位置&gt;</span><br></pre></td></tr></table></figure>
<p>使用 allure 暫存檔生成報表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allure generate &lt;allure 暫存檔存放位置&gt; -o &lt;輸出報表位置&gt; --clean</span><br></pre></td></tr></table></figure>


<p>方法二</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install allure-pytest</span><br></pre></td></tr></table></figure>
<p>執行測試並產生 allure 暫存檔<br>py.test –alluredir&#x3D;&lt;allure 暫存檔存放位置&gt; &lt;測試檔案 or 目錄&gt;</p>
<p>使用 allure 暫存檔生成報表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allure serve &lt;allure 暫存檔存放位置&gt;</span><br></pre></td></tr></table></figure>

<div class="note warning simple"><p>目前測試產生的</p>
</div>

<h3 id="使用docker-compose在docker容器中運行pytest"><a href="#使用docker-compose在docker容器中運行pytest" class="headerlink" title="使用docker-compose在docker容器中運行pytest"></a>使用docker-compose在docker容器中運行pytest</h3><div class="note info simple"><p>參考文章: <a target="_blank" rel="noopener" href="https://geek-docs.com/pytest/pytest-questions/9_pytest_how_to_run_pytest_from_a_docker_container_within_dockercompose.html">https://geek-docs.com/pytest/pytest-questions/9_pytest_how_to_run_pytest_from_a_docker_container_within_dockercompose.html</a></p>
</div>

<p>安裝套件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest pytest-docker</span><br></pre></td></tr></table></figure>


<h1 id="環境設定"><a href="#環境設定" class="headerlink" title="環境設定"></a>環境設定</h1><h2 id="setup、teardown"><a href="#setup、teardown" class="headerlink" title="setup、teardown"></a>setup、teardown</h2><p>在 function 等級設定 setup、teardown 時，會於每個 function 的開始以及結束時都會執行一次</p>
<h3 id="建立-env-檔案"><a href="#建立-env-檔案" class="headerlink" title="建立 .env 檔案"></a>建立 .env 檔案</h3><p>env 檔案當中時常會保留我們不想要進入版本控制的重要資訊</p>
<div class="note info simple"><p>注意： github 上的專案並沒有把 .env 推上去，若想使用請自行建立</p>
</div>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ACCOUNT=&quot;test_account_123&quot;</span><br><span class="line">PASSWORD=&quot;test_password_123&quot;</span><br></pre></td></tr></table></figure>

<h3 id="安裝套件-1"><a href="#安裝套件-1" class="headerlink" title="安裝套件"></a>安裝套件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-dotenv</span><br></pre></td></tr></table></figure>

<h3 id="撰寫測試環境"><a href="#撰寫測試環境" class="headerlink" title="撰寫測試環境"></a>撰寫測試環境</h3><p>建立 test_example.py 檔案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import dotenv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def setup_module():</span><br><span class="line">    dotenv.load_dotenv(&quot;./.env&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_get_env_account():</span><br><span class="line">    print(os.getenv(&quot;ACCOUNT&quot;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_get_env_password():</span><br><span class="line">    print(os.getenv(&quot;PASSWORD&quot;))</span><br></pre></td></tr></table></figure>



<h2 id="fixture"><a href="#fixture" class="headerlink" title="fixture"></a>fixture</h2><h3 id="目錄架構"><a href="#目錄架構" class="headerlink" title="目錄架構"></a>目錄架構</h3><p><img src="https://hackmd.io/_uploads/ByeEkGglT.png"></p>
<h3 id="快速建立-fixtures-py-檔案"><a href="#快速建立-fixtures-py-檔案" class="headerlink" title="快速建立 fixtures.py 檔案"></a>快速建立 fixtures.py 檔案</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line">import requests</span><br><span class="line">from fake_useragent import FakeUserAgent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;headers&quot;, scope=&quot;function&quot;, autouse=False)</span><br><span class="line">def headers_fixture() -&gt; dict:</span><br><span class="line">    ua = FakeUserAgent()</span><br><span class="line">    headers = &#123;&quot;User-Agent&quot;: ua.random&#125;</span><br><span class="line"></span><br><span class="line">    return headers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;make_user_agent&quot;, scope=&quot;function&quot;, autouse=False)</span><br><span class="line">def make_user_agent_fixture() -&gt; dict:</span><br><span class="line">    ua = FakeUserAgent()</span><br><span class="line">    headers = &#123;&quot;User-Agent&quot;: ua.random&#125;</span><br><span class="line"></span><br><span class="line">    return headers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;parse_user_agent&quot;, scope=&quot;function&quot;, autouse=False)</span><br><span class="line">def parse_user_agent_fixture(make_user_agent: dict) -&gt; dict:</span><br><span class="line">    url = &quot;https://httpbin.org/headers&quot;</span><br><span class="line">    res = requests.get(url=url, headers=make_user_agent)</span><br><span class="line">    user_agent = res.json()[&quot;headers&quot;][&#x27;User-Agent&#x27;]</span><br><span class="line"></span><br><span class="line">    return &#123;&quot;User-Agent&quot;: user_agent&#125;</span><br></pre></td></tr></table></figure>

<h3 id="fixture-裝飾器參數介紹"><a href="#fixture-裝飾器參數介紹" class="headerlink" title="fixture 裝飾器參數介紹"></a>fixture 裝飾器參數介紹</h3><table>
<thead>
<tr>
<th>參數</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>scope</td>
<td>表示作用域，預設為 “function”，亦即每個有用到此 fixture 的 test case 都會執行，另外還有 module、class 以及 session 三種</td>
</tr>
<tr>
<td>name</td>
<td>用來設定 fixture 的別名，預設為函式名稱</td>
</tr>
<tr>
<td>autouse</td>
<td>預設為 False，若為 True，則會自動進行使用 (根據 scope 作用域而定)</td>
</tr>
</tbody></table>
<h3 id="程式解釋"><a href="#程式解釋" class="headerlink" title="程式解釋"></a>程式解釋</h3><p>利用 @pytest.fixture 標註該函式為 fixture<br>利用 fake_useragent 隨機生成一個 User-Agent (需另外安裝 fake-useragent 套件)<br>回傳 headers 給有使用此 fixture 的 test case</p>
<h3 id="使用-fixture"><a href="#使用-fixture" class="headerlink" title="使用 fixture"></a>使用 fixture</h3><p>接著我們回到 test_demo.py 當中，來使用剛剛所製作的 fixture。使用的方式則非常簡單，首先我們必須將剛剛撰寫好的 fixture 的 function 給 import 進來，這樣 pytest 才抓地到，接著只需要在 test case 接收參數的地方打上剛剛為 fixture 命名的名稱 (若無則預設為 fixture 的 function name)，接著我們就可以在 test case 內使用此 fixture 回傳出的內容了。</p>
<p>1.將要使用 fixture 先進行 import</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from fixtures import headers_fixture, parse_user_agent_fixture, make_user_agent_fixture</span><br></pre></td></tr></table></figure>

<p>2.利用 <a target="_blank" rel="noopener" href="https://httpbin.org/headers">https://httpbin.org/headers</a> 來取得我們送出去的 headers</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def test_assert_headers(headers: dict):</span><br><span class="line">    url = &quot;https://httpbin.org/headers&quot;</span><br><span class="line">    res = requests.get(url=url, headers=headers)</span><br><span class="line"></span><br><span class="line">    print(res.status_code)</span><br><span class="line">    print(res.json())</span><br><span class="line"></span><br><span class="line">    assert res.status_code == 200</span><br><span class="line">    assert res.json()[&#x27;headers&#x27;][&quot;User-Agent&quot;] == headers[&quot;User-Agent&quot;]</span><br></pre></td></tr></table></figure>
<p>3.最後驗證取得的 headers 和我們利用 fixture 製作的 headers 是否相等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def test_assert_user_agent(make_user_agent: dict, parse_user_agent: dict):</span><br><span class="line">    assert make_user_agent == parse_user_agent</span><br></pre></td></tr></table></figure>

<p>備註：本測試範例只使用了一個 fixture 作為展示，實際上一個 test case 可以同時使用多個 fixture 是沒問題的</p>
<h3 id="fixture-使用時機"><a href="#fixture-使用時機" class="headerlink" title="fixture 使用時機"></a>fixture 使用時機</h3><ol>
<li><p>為 test case 建立環境時<br> 若是有很多個 test case 在測試前需要做一些環境的建置、參數的準備，則很適合適用 fixture</p>
</li>
<li><p>當你不想使用 setup、teardown 時<br> 由於使用 setup、teardown 會造成該 .py 檔內的所有 test case 都被引響，而 fixture 若沒有被寫在 test case 接收的參數內，則不會被影響 (除非作用域不為 function 且 autouse&#x3D;False)</p>
</li>
</ol>
<p>以上練習是參考 iTHome 鐵人賽 Python 與自動化測試的敲門磚 文章跟著練習的內容</p>
<h1 id="虛擬資料庫"><a href="#虛擬資料庫" class="headerlink" title="虛擬資料庫"></a>虛擬資料庫</h1><h2 id="虛擬關聯式資料庫-SQLite"><a href="#虛擬關聯式資料庫-SQLite" class="headerlink" title="虛擬關聯式資料庫 SQLite"></a>虛擬關聯式資料庫 SQLite</h2><h3 id="專案架構介紹"><a href="#專案架構介紹" class="headerlink" title="專案架構介紹"></a>專案架構介紹</h3><p><img src="https://hackmd.io/_uploads/BJaRufglp.png"></p>
<table>
<thead>
<tr>
<th>檔案</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>crud.py</td>
<td>存放對資料庫做 CRUD 操作的函式</td>
</tr>
<tr>
<td>fixtures.py</td>
<td>存放使用 pytest 製作出的 fixture</td>
</tr>
<tr>
<td>models.py</td>
<td>存放 sqlalchemy 建立的 ORM 架構</td>
</tr>
<tr>
<td>test_demo.py</td>
<td>存放 test case</td>
</tr>
</tbody></table>
<h3 id="資料庫路徑"><a href="#資料庫路徑" class="headerlink" title="資料庫路徑"></a>資料庫路徑</h3><p>用在將資料庫與 ORM 架構做連線時的資料庫位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql+pymysql://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database_name&gt;</span><br></pre></td></tr></table></figure>

<p>今天要介紹的虛擬關聯式資料庫，是使用 SQLite 所提供的 In-memory 的資料庫，使用的路徑非常簡單，如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite://</span><br></pre></td></tr></table></figure>

<p>且由於 python 內自帶 sqlite 的套件，所以只要將上面的路徑放入資料庫連線的路徑，電腦就會動使用記憶體協助我們進行資料表的建立以及操作</p>
<h3 id="建立測試內容"><a href="#建立測試內容" class="headerlink" title="建立測試內容"></a>建立測試內容</h3><p>這邊我們會先簡單介紹放在 models 的內容以及要被測試的 CRUD 的函式</p>
<p>models.py<br>建立一張名為 User 的資料表並且有 id 、 username 以及 birthday 三個欄位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy.ext.declarative import declarative_base</span><br><span class="line">from sqlalchemy import String, Column, Integer, DATETIME</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class User(Base):</span><br><span class="line">    __tablename__ = &quot;user&quot;</span><br><span class="line">    id: int = Column(Integer, primary_key=True, autoincrement=True)</span><br><span class="line">    username: str = Column(String(64))</span><br><span class="line">    birthday: datetime = Column(DATETIME)</span><br></pre></td></tr></table></figure>
<p>crud.py<br>建立一個可以利用 sqlalchemy 寫入資料的 function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy.orm import Session</span><br><span class="line">from models import User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def create_user_in_sqlite(data: User, session: Session) -&gt; User:</span><br><span class="line">    session.add(data)</span><br><span class="line">    session.commit()</span><br><span class="line">    session.refresh(data)</span><br><span class="line"></span><br><span class="line">    return data</span><br></pre></td></tr></table></figure>

<h3 id="建立-fixture"><a href="#建立-fixture" class="headerlink" title="建立 fixture"></a>建立 fixture</h3><p>接下來就是重點了，sqlalchemy 實際對資料庫進行操作的時後，需要一個 session 物件來協助我們進行操作，接下來我們就要利用 fixture 來替我們在測試前做建立資料表以及產生一個 session 的動作</p>
<p>程式解析：</p>
<p>利用剛剛所介紹的方法，先建立一個 engine 並與虛擬的 sqlite 進行連線<br>在測試之前我們先利用 fixture 替我們將資料表建立好，這樣在測試的過程中就不需要再花時間在撰寫建立環境的部分<br>接著我們實際建立一個 session 並 yield 出去<br>使用 yield 的原因是，當 test case 結束後，就會回到 fixture 內執行接下來的動作<br>由於式使用 with 進行 session 的建立，因此也 test case 結束後回到 fixture 內，此 session 會自動關閉<br>最後 test case 結束會到 fixture 內將資料表全部刪除，確保下一個 test case 有乾淨的環境做測試</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.orm import Session, sessionmaker</span><br><span class="line">from models import Base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;sqlite_session&quot;)</span><br><span class="line">def sqlite_session_fixture() -&gt; Session:</span><br><span class="line">    # 建立 engine</span><br><span class="line">    engine_url = &quot;sqlite://&quot;</span><br><span class="line">    engine = create_engine(engine_url)</span><br><span class="line"></span><br><span class="line">    # 建立資料表</span><br><span class="line">    Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line">    #  yield 出 Session</span><br><span class="line">    with sessionmaker(bind=engine)() as session:</span><br><span class="line">        yield session</span><br><span class="line"></span><br><span class="line">    # 刪除資料表</span><br><span class="line">    Base.metadata.drop_all(engine)</span><br></pre></td></tr></table></figure>

<h3 id="建立測試程式"><a href="#建立測試程式" class="headerlink" title="建立測試程式"></a>建立測試程式</h3><p>接下來就來就準備撰寫 test case 了，一樣附上程式碼並逐行解釋</p>
<p>程式解析：</p>
<p>將所使用到的套件分別進行 import<br>建立 test case 並使用 fixture sqlite_session 並提示 IDE 此為一個 Session 型態的參數<br>利用 User 建立一個測試資料<br>利用 crud 內的函式對資料庫測式寫入<br>驗證寫入函式回傳出的 username 是否和我們手動建立的 username 是否一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from crud import create_user_in_sqlite</span><br><span class="line">from models import User</span><br><span class="line">from fixtures import sqlite_session_fixture</span><br><span class="line">from sqlalchemy.orm import Session</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">use_fixtures = [sqlite_session_fixture]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_create_user_in_sqlite(sqlite_session: Session):</span><br><span class="line">    data = User(username=&quot;test_user&quot;, birthday=datetime.now())</span><br><span class="line"></span><br><span class="line">    result: User = create_user_in_sqlite(data=data, session=sqlite_session)</span><br><span class="line">    print(result.__dict__)</span><br><span class="line"></span><br><span class="line">    assert result.username == data.username</span><br></pre></td></tr></table></figure>

<div class="note info simple"><p>測試需要安裝套件<br>pip install sqlalchemy</p>
</div>

<h3 id="成果展示"><a href="#成果展示" class="headerlink" title="成果展示"></a>成果展示</h3><p>接著我們就可以利用 pytest 對 test_demo.py 進行測試了，下方為測試結果截圖<br><img src="https://hackmd.io/_uploads/Hy_SRflxT.png"></p>
<h2 id="NoSQL-陣營的虛擬資料庫套件-MongoMock"><a href="#NoSQL-陣營的虛擬資料庫套件-MongoMock" class="headerlink" title="NoSQL 陣營的虛擬資料庫套件 - MongoMock"></a>NoSQL 陣營的虛擬資料庫套件 - MongoMock</h2><h3 id="套件安裝"><a href="#套件安裝" class="headerlink" title="套件安裝"></a>套件安裝</h3><p>pymongo：正式用來撰寫 mongo 相關的 CRUD 時常用的套件，crud.py 內的 MongoClient，會由此套件產生</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymongo</span><br></pre></td></tr></table></figure>
<p>mongomock：協助用來建立一個虛擬的 MongoClient 讓我們可以透過 fixture 的方式來進行 crud.py 的測試</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mongomock</span><br></pre></td></tr></table></figure>

<h3 id="建立-crud"><a href="#建立-crud" class="headerlink" title="建立 crud"></a>建立 crud</h3><p>這邊會在 crud.py 檔案內建立一個寫入資料的方式，直接附上範例並進行解說</p>
<div class="note warning simple"><p>注意：在正式的專案檔案中 (即非測試程式) 需要使用 pymongo 所提供的 MongoClient，才不會造成不可避免的錯誤</p>
</div>

<p>程式解析：</p>
<p>import pymongo 的 MongoClient，進行 mongo 的 CRUD<br>建立一個 insert_user 函式<br>進行資料的寫入<br>寫入的同時取得 id<br>寫入完畢後透過 id 查詢該筆資料並回傳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pymongo.mongo_client import MongoClient</span><br><span class="line"></span><br><span class="line">database_name = &quot;test&quot;</span><br><span class="line">collection_name = &quot;user&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def insert_user(conn: MongoClient, data: dict) -&gt; dict:</span><br><span class="line">    # 插入資料並取得 id</span><br><span class="line">    insert_id = conn[database_name][collection_name].insert_one(data).inserted_id</span><br><span class="line"></span><br><span class="line">    # 藉由 id 搜尋並回傳</span><br><span class="line">    result = conn[database_name][collection_name].find_one(&#123;&quot;_id&quot;: insert_id&#125;)</span><br><span class="line">    return result</span><br></pre></td></tr></table></figure>

<h3 id="建立-fixtures"><a href="#建立-fixtures" class="headerlink" title="建立 fixtures"></a>建立 fixtures</h3><p>接著我們要利用 MongoMock 所提供的 MongoClient 來進行 fixture 的撰寫，在開頭有提到，MongoMock 可以很好的兼容 PyMongo，因此我們可以直接使用 MongoMock 的 MongoClient 來進行 CRUD 的測試，範例如下</p>
<p>注意：雖然 MongoMock 可以很好的兼容 PyMongo 不過由於版本問題，某些功能還是會無法使用，因此若測試過程中有跳錯，請留意一下錯誤訊息，看看是否為 MongoMock 還沒支援相關功能</p>
<p>程式解析：</p>
<p>import mongomock 的 MongoClient<br>建立一個 fixture 命名為 conn<br>利用 mongomock 的 MongoClient 建立一個虛擬的連線<br>透過 yield 回傳出去給 test case 使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line">from mongomock.mongo_client import MongoClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;conn&quot;)</span><br><span class="line">def mongo_client_fixture() -&gt; MongoClient:</span><br><span class="line">    with MongoClient() as conn:</span><br><span class="line">        yield conn</span><br></pre></td></tr></table></figure>

<h3 id="test-case-建立"><a href="#test-case-建立" class="headerlink" title="test case 建立"></a>test case 建立</h3><p>最後我們要來建立測試程式了，直接附上範例進行解釋</p>
<p>程式解析：</p>
<p>將需要使用到的套件 import 進來<br>建立一筆假資料<br>調用 crud 當中的 insert_user 進行寫入測試<br>驗證回傳出的資料是否和我們建立的假資料內容一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from datetime import datetime</span><br><span class="line">from pymongo.mongo_client import MongoClient</span><br><span class="line">from fixtures import mongo_client_fixture</span><br><span class="line">from crud import insert_user</span><br><span class="line"></span><br><span class="line">use_fixtures = [mongo_client_fixture]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_insert_user(conn: MongoClient):</span><br><span class="line">    # 建立假資料</span><br><span class="line">    data = &#123;&quot;username&quot;: &quot;nick&quot;,</span><br><span class="line">            &quot;email&quot;: &quot;test@test&quot;,</span><br><span class="line">            &quot;birthday&quot;: datetime(year=2022, month=12, day=31)&#125;</span><br><span class="line">    </span><br><span class="line">    # 測試 CRUD 方法</span><br><span class="line">    result = insert_user(data=data, conn=conn)</span><br><span class="line">    print(result)</span><br><span class="line">    </span><br><span class="line">    # 驗證內容</span><br><span class="line">    assert result[&quot;username&quot;] == data[&quot;username&quot;]</span><br><span class="line">    assert result[&quot;email&quot;] == data[&quot;email&quot;]</span><br><span class="line">    assert result[&quot;birthday&quot;] == data[&quot;birthday&quot;]</span><br></pre></td></tr></table></figure>

<h1 id="驗證錯誤與跳過案例"><a href="#驗證錯誤與跳過案例" class="headerlink" title="驗證錯誤與跳過案例"></a>驗證錯誤與跳過案例</h1><h2 id="驗證錯誤"><a href="#驗證錯誤" class="headerlink" title="驗證錯誤"></a>驗證錯誤</h2><p>程式解析：</p>
<p>建立 raise_error 函式來手動引發一個錯誤<br>於 test_error 內使用 pytest.raises(IndexError) 來驗證函式引發的錯誤種類是否如預期</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def raise_error():</span><br><span class="line">    raise IndexError(&quot;list 的位置錯誤&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_error():</span><br><span class="line">    with pytest.raises(IndexError):</span><br><span class="line">        raise_error()</span><br></pre></td></tr></table></figure>

<p>注意：經筆者測試，在 pytest 驗證到預期內的錯誤訊息後，無法在同個 with 區域內進行其他驗證，都會顯示正確，若有需要驗證其他錯誤 or 案例，則需另開一個 with，或是將程式寫在 with 外部</p>
<p>如下方程式所示，手動驗證一個錯誤的條件需要寫在接收到預期錯誤的 with 區域之外，才會被檢查到錯誤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def test_error():</span><br><span class="line">    with pytest.raises(IndexError):</span><br><span class="line">        raise_error()</span><br><span class="line"></span><br><span class="line">    assert 1 + 1 == 3</span><br></pre></td></tr></table></figure>


<h3 id="驗證錯誤訊息"><a href="#驗證錯誤訊息" class="headerlink" title="驗證錯誤訊息"></a>驗證錯誤訊息</h3><p>pytest.raises() 除了在接收到預期內的錯誤不會報錯之外，我們也可以針對錯誤訊息的內容進行驗證</p>
<p>程式解析：</p>
<p>with pytest.raises(IndexError) as exc 我們可以理解成把接收到的錯誤丟給一個叫做 exc 的變數，並於外部做使用<br>驗證錯誤訊息的內容<br>驗證錯誤訊息的 class name</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def test_error_message():</span><br><span class="line">    # 將接收到的錯誤丟給一個名為 exc 的變數，該變數可於外部使用</span><br><span class="line">    with pytest.raises(IndexError) as exc:</span><br><span class="line">        raise_error()</span><br><span class="line">    </span><br><span class="line">    # 印出錯誤訊息內容並驗證</span><br><span class="line">    print(str(exc.value))</span><br><span class="line">    assert str(exc.value) == &quot;list 的位置錯誤&quot;</span><br><span class="line">    </span><br><span class="line">    # 印出錯誤訊息類別並驗證</span><br><span class="line">    print(str(exc.typename))</span><br><span class="line">    assert exc.typename == IndexError.__name__</span><br></pre></td></tr></table></figure>

<h3 id="跳過-test-case"><a href="#跳過-test-case" class="headerlink" title="跳過 test case"></a>跳過 test case</h3><p>某些情況下，我們可能會不想讓一些 test case 被執行，比方說某個 function 只能用在某個版本的時候，或是在某種作業系統上該函式使用的套件會失效，又或是暫時不想刪除，碰到這類的情況 pytest 有提供了跳過的功能，分別為 skip 和 skipif</p>
<p>為了測試方便，我們會將接下來的兩個範例連同上面所撰寫的兩個 test case 一起執行，並且觀察 pytest 收集到的 test case 數量</p>
<h3 id="直接跳過-skip"><a href="#直接跳過-skip" class="headerlink" title="直接跳過 skip"></a>直接跳過 skip</h3><p>程式解析：</p>
<p>利用 @pytest.mark.skip() 裝飾器的方式來標註該案例需要跳過<br>reason 則是用來撰寫跳過的原因，該原因會被印在 terminal 上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@pytest.mark.skip(reason=&quot;測試案例跳過範例&quot;)</span><br><span class="line">def test_skip_test_case():</span><br><span class="line">    assert 1 + 1 == 3</span><br></pre></td></tr></table></figure>
<p>結果展示：</p>
<p>可以看到下方圖片中，pytest 有成功蒐集到三個 test case，而第三個 test case 狀態為 SKIPPED 並且原因印出於狀態後方</p>
<h3 id="有條件跳過-skipif"><a href="#有條件跳過-skipif" class="headerlink" title="有條件跳過 skipif"></a>有條件跳過 skipif</h3><p>我們可以透過指定 sys 內的條件來進行跳過，下方的範例就是讀取目前的作業系統，如果為 “win32” 就不執行此範例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.mark.skipif(condition=sys.platform == &quot;win32&quot;, reason=&quot;測試跳過指定條件範例&quot;)</span><br><span class="line">def test_skip_test_case_by_condition():</span><br><span class="line">    assert 1 + 1 == 4</span><br></pre></td></tr></table></figure>

<p>另外我們可以透過印出 sys 內的物件及屬性，來查看有哪些條件可以支援</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(dir(sys))</span><br></pre></td></tr></table></figure>
<h1 id="parametrize-自動生成多筆測試"><a href="#parametrize-自動生成多筆測試" class="headerlink" title="parametrize 自動生成多筆測試"></a>parametrize 自動生成多筆測試</h1><p>今天我們要介紹如何利用 pytest 提供的 parametrize 來自動生成多筆測試，這個方式通常用於硬體的測試，需要使用很多不同的數值來對某個功能做測試，例如：USB 寫入速度跟寫入的檔案大小，但測試的 function 其實是一樣的，像這種情況我們就不需要撰寫多個 test case，利用 parametrize 的方式來進行測試即可</p>
<h2 id="簡單範例"><a href="#簡單範例" class="headerlink" title="簡單範例"></a>簡單範例</h2><p>下面我們直接上範例來進行解釋</p>
<p>程式解析：</p>
<p>利用裝飾器的方式來進行 parametrize 的撰寫<br>argnames 為一組字串，分別要對應到 test case 內所需接收的參數<br>注意：請不要將格式寫成　‘num1’, ‘num2’… 應該將所有名稱包在同一組字串內，如　‘num1, num2, …’<br>argvalues 用一個串列包起來並將每一組測試資料也用一個串列包起來，形成一個二維串列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 基本範例</span><br><span class="line">@pytest.mark.parametrize(argnames=&#x27;num1, num2, result&#x27;, argvalues=[(1, 1, 2), (2, 2, 4)])</span><br><span class="line">def test_add(num1: int, num2: int, result: int):</span><br><span class="line">    assert num1 + num2 == result</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/S1iE5IZea.png"></p>
<h2 id="搭配檔案讀取"><a href="#搭配檔案讀取" class="headerlink" title="搭配檔案讀取"></a>搭配檔案讀取</h2><p>除此之外，我們也可以將多組測試參數寫進檔案中，在測試之前先讀取進 python 中，於裝飾器內再指派給 test case</p>
<p>test_args.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;test_add&quot;: [[1, 1, 2], [2, 2, 4]]&#125;</span><br></pre></td></tr></table></figure>
<p>test_demo.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">import pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 搭配檔案讀取</span><br><span class="line">with open(&quot;./test_args.json&quot;, &quot;r&quot;, encoding=&quot;utf8&quot;) as file:</span><br><span class="line">    test_args = json.loads(file.read())[&#x27;test_add&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.mark.parametrize(argnames=&#x27;num1, num2, result&#x27;, argvalues=test_args)</span><br><span class="line">def test_add_with_json_file(num1: int, num2: int, result: int):</span><br><span class="line">    assert num1 + num2 == result</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/BkDTqLWxT.png"></p>
<blockquote>
<p>測試結果</p>
</blockquote>
<h2 id="ids-的使用"><a href="#ids-的使用" class="headerlink" title="ids 的使用"></a>ids 的使用</h2><p>如果同時生成許多組測試，可能會造成閱讀上的不易，這時候我們可以透過 ids 來為每一組測試提供名稱</p>
<p>這邊我們會沿用上方讀取 json 後產生的 test_args，並手動根據 test_args 的長度來建立相關的 id，當然 ids 也可以利用讀取檔案的方式讀取近來，只要數量符合測試資料筆數，且型態為 list 即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ids 的使用</span><br><span class="line">ids = [f&quot;case: &#123;i&#125;&quot; for i in range(1, len(test_args) + 1)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.mark.parametrize(argnames=&#x27;num1, num2, result&#x27;, argvalues=test_args, ids=ids)</span><br><span class="line">def test_add_with_json_file_and_ids(num1: int, num2: int, result: int):</span><br><span class="line">    assert num1 + num2 == result</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/SJkFiIbx6.png"></p>
<blockquote>
<p>可以看到 pytest 成功為我們的每組測試都加上名稱</p>
</blockquote>
<h2 id="搭配-fixture-做使用"><a href="#搭配-fixture-做使用" class="headerlink" title="搭配 fixture 做使用"></a>搭配 fixture 做使用</h2><p>網路上有很多 fixture 搭配 parametrize 的使用方式，不過筆者試了一下，發現 fixture 其實可以很直覺的 import 進來直接使用，請看下面範例</p>
<p>fixtures.py<br>建立一個 fixture 用來展示用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line">from mongomock.mongo_client import MongoClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;conn&quot;)</span><br><span class="line">def mongo_client_fixture() -&gt; MongoClient:</span><br><span class="line">    with MongoClient() as conn:</span><br><span class="line">        yield conn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>test_demo.py<br>可以看到在這個 test case 當中，直接將 import 進來的 fixture name 打在 test case 最後面的參數，即可進行使用，請務必將 fixture 放在最尾端避免造成額外的錯誤</p>
<p>為了驗證是否真的有被 import 近來，第二個 assert 的部分為驗證 conn 參數是否為 MongoClient 型態，而非 None</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from fixtures import mongo_client_fixture</span><br><span class="line">from mongomock.mongo_client import MongoClient</span><br><span class="line"></span><br><span class="line">use_fixtures = [mongo_client_fixture]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 搭配 fixture 使用</span><br><span class="line">@pytest.mark.parametrize(argnames=&#x27;num1, num2, result&#x27;, argvalues=[(1, 1, 2), (2, 2, 4)])</span><br><span class="line">def test_add_with_fixtures(num1: int, num2: int, result: int, conn: MongoClient):</span><br><span class="line">    assert num1 + num2 == result</span><br><span class="line">    assert isinstance(conn, MongoClient)</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/SJEtnoMe6.png"></p>
<h1 id="conftest-py"><a href="#conftest-py" class="headerlink" title="conftest.py"></a>conftest.py</h1><h2 id="conftest-py-簡介"><a href="#conftest-py-簡介" class="headerlink" title="conftest.py 簡介"></a>conftest.py 簡介</h2><p>白話來說 conftest.py 就是一個可以讓我們存放 “經常被使用到” 的 fixture 的地方，被存放在 conftest.py 當中的 fixture 不需要透過 import就可以直接進行使用，pytest 在一開始執行時，就會先去抓是否有 conftest.py 的存在，因此若今天發現你的 fixture 被許多個 test module 使用到的話不彷可以試著將 fixture 放到 conftest.py 當中</p>
<p>順帶一提 conftest.py 的有效範圍是從 conftest.py 所存在的當前目錄以及其所有子目路中的 test case 都可以使用，若於不同目錄則需要另外寫一個 conftest.py</p>
<p>在本次的範例當中，會利用新增 pytest cmd argument 的方式來進行範例展示，下方附上本次專案目錄的結構</p>
<p><img src="https://hackmd.io/_uploads/SJuMajGeT.png"></p>
<h2 id="範例展示"><a href="#範例展示" class="headerlink" title="範例展示"></a>範例展示</h2><h3 id="建立-conftest-py"><a href="#建立-conftest-py" class="headerlink" title="建立 conftest.py"></a>建立 conftest.py</h3><p>conftest.py</p>
<ul>
<li>pytest_addoption 為 pytest 內建的 fixture，可以自定使用 cmd 執行時的參數</li>
<li>建立一個名為 permission 的參數，用來識別權限</li>
<li>建立 permission_fixture 用來讀取權限檔案，來識別使用者可以測試的範圍</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">import pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pytest_addoption(parser):</span><br><span class="line">    parser.addoption(&quot;--permission&quot;, default=&quot;RD&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@pytest.fixture(name=&quot;permission&quot;)</span><br><span class="line">def permission_fixture(pytestconfig):</span><br><span class="line">    role = pytestconfig.getoption(&quot;permission&quot;)</span><br><span class="line">    with open(&quot;./permission.json&quot;, &quot;r&quot;) as file:</span><br><span class="line">        permission_data = json.loads(file.read())</span><br><span class="line">    if role == &quot;RD&quot;:</span><br><span class="line">        permission = permission_data[&quot;RD&quot;]</span><br><span class="line">    else:</span><br><span class="line">        permission = permission_data[&quot;costumer&quot;]</span><br><span class="line"></span><br><span class="line">    return permission</span><br></pre></td></tr></table></figure>

<h3 id="建立-json-檔用來控制權限"><a href="#建立-json-檔用來控制權限" class="headerlink" title="建立 json 檔用來控制權限"></a>建立 json 檔用來控制權限</h3><p>permission.json</p>
<ul>
<li>如果角色是 RD，則可以進行 select、update、delete</li>
<li>其餘的則定位為 costumer，只能進行 select 的測試<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;RD&quot;: [</span><br><span class="line">    &quot;select&quot;,</span><br><span class="line">    &quot;update&quot;,</span><br><span class="line">    &quot;delete&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;costumer&quot;: [</span><br><span class="line">    &quot;select&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="撰寫-test-case"><a href="#撰寫-test-case" class="headerlink" title="撰寫 test case"></a>撰寫 test case</h3><p>test_demo.py</p>
<ul>
<li>大家可以發現，這裡使用 permission 這個 fixture 的時候並沒有像之前一樣進行 import 可以直接使用</li>
<li>分別有 select、update 兩項測試，並且於測試之前會進行權限的驗證</li>
<li>於 test_update_permission 的時候，若權限不足則會引發錯誤，並驗證錯誤訊息<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_select_permission(permission: list):</span><br><span class="line">    if &quot;select&quot; in permission:</span><br><span class="line">        assert True</span><br><span class="line">    else:</span><br><span class="line">        assert False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_update_permission(permission: list):</span><br><span class="line">    if &quot;update&quot; in permission:</span><br><span class="line">        assert True</span><br><span class="line">    else:</span><br><span class="line">        with pytest.raises(ValueError) as exc:</span><br><span class="line">            raise ValueError(&quot;permission not allow&quot;)</span><br><span class="line"></span><br><span class="line">        print(str(exc.value))</span><br><span class="line">        assert str(exc.value) == &quot;permission not allow&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="結果展示"><a href="#結果展示" class="headerlink" title="結果展示"></a>結果展示</h3><p>啟動 pytest 指令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -s -v --permission costumer .\test_demo.py</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/r1iJe2Gxp.png"></p>
<blockquote>
<p>可以看到當 permission 為 costumer 時，成功地引發了錯誤並通過錯誤訊息的驗證</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -s -v --permission RD .\test_demo.py</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SkK-ehGxp.png"></p>
<blockquote>
<p>當權限為 RD 時，則 update 的部分不會引發錯誤</p>
</blockquote>
<h1 id="問題排除"><a href="#問題排除" class="headerlink" title="問題排除"></a>問題排除</h1><h2 id="chrome-driver版本過舊"><a href="#chrome-driver版本過舊" class="headerlink" title="chrome driver版本過舊"></a>chrome driver版本過舊</h2><p>selenium.common.exceptions.SessionNotCreatedException: Message: session not created: This version of ChromeDriver only supports Chrome version 114</p>
<p>這個原因是 chrome 常常會更新  導致 chrome driver版本過舊</p>
<p>這時候要到這邊下載最新的<br><a target="_blank" rel="noopener" href="https://googlechromelabs.github.io/chrome-for-testing/">https://googlechromelabs.github.io/chrome-for-testing/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/117.0.5938.92/linux64/chromedriver-linux64.zip</span><br></pre></td></tr></table></figure>
<p>解壓縮</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip chromedriver-linux64.zip</span><br></pre></td></tr></table></figure>

<p>到 chromedriver-linux64 資料夾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd chromedriver-linux64</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mv chromedriver /usr/bin/chromedriver</span><br><span class="line">sudo chown root:root /usr/bin/chromedriver</span><br><span class="line">sudo chmod +x /usr/bin/chromedriver</span><br></pre></td></tr></table></figure>



<p>參考文章:<br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10293187">https://ithelp.ithome.com.tw/articles/10293187</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_24166417/article/details/113850978">https://blog.csdn.net/qq_24166417/article/details/113850978</a><br><a target="_blank" rel="noopener" href="https://github.com/nickchen1998/2022_ithelp_marathon">https://github.com/nickchen1998/2022_ithelp_marathon</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://gahgah147.github.io">Nalson Lai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章連結: </span><span class="post-copyright-info"><a href="https://gahgah147.github.io/2023/09/22/Pytest-%E8%87%AA%E5%8B%95%E6%B8%AC%E8%A9%A6/">https://gahgah147.github.io/2023/09/22/Pytest-%E8%87%AA%E5%8B%95%E6%B8%AC%E8%A9%A6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版權聲明: </span><span class="post-copyright-info">本部落格所有文章除特別聲明外，均採用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 授權協議。轉載請註明來源 <a href="https://gahgah147.github.io" target="_blank">Nalson</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Pytest/">Pytest</a><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6/">自動化測試</a></div><div class="post-share"><div class="social-share" data-image="/img/catchorange.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/09/23/%E4%BD%BF%E7%94%A8docker%E5%9F%B7%E8%A1%8Cjenkins/" title="使用docker執行jenkins"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">使用docker執行jenkins</div></div><div class="info-2"><div class="info-item-1">使用docker執行jenkins拉取docker hub上的jenkins image1docker pull jenkinsci/blueocean  運行docker 鏡像命令12345678910docker run \  -u root \  --rm \  -d \  -p 8081:8080 \  -p 50000:50000 \  -v jenkins-data:/root/docker/jenkins_home \  -v $PWD/allure-results:/allure-results \  -v /var/run/docker.sock:/var/run/docker.sock \  jenkinsci/blueocean    執行後可以看見docker 運行的狀況  打開8081 port，登入jenkins首頁http://localhost:8081/ 進入容器取得管理員密碼點擊docker   點擊 Terminal   輸入 cat...</div></div></div></a><a class="pagination-related" href="/2023/09/21/Python-%E8%88%87%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6/" title="Python 與自動化測試"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Python 與自動化測試</div></div><div class="info-2"><div class="info-item-1">前言這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 主題   主題 日程    簡介 day 01   Pytest day 02 ~ 10   TDD day 11 ~ 12   Selenium day 13 ~ 17   Appium day 18 ~ 21   CI&#x2F;CD day 22 ~ 26   Jenkins day 27 ~ 29   結語 day 30   PytestPytest 是一種使用在 Python 語言裡面的一中單元測試框架，而 Pytest 基本上就是由 Python 原生自帶的單元測試框架 Unittest 衍生出來的，所以可以看到有些範例可以和 Unittest 的套件互相兼容混用。 Pytest 和 Unittest 相比，有下列幾項優點：  更易於上手，撰寫 testcase 時較為直覺 擴展性高，可以兼容許多外掛套件 可以標註某些 testcase 為失敗是正常的 測試程式撰寫起來相較於 unittest 較為簡潔  TDDTDD 完整名稱為 Test-driven development，中譯為...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相關推薦</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/10/02/TDD-%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E6%B5%81%E7%A8%8B/" title="TDD 測試驅動開發流程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-02</div><div class="info-item-2">TDD 測試驅動開發流程</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 TDD 簡介TDD 全名為 Test-Driven Development 中文翻譯為 「測試驅動開發」，顧名思義就是藉著撰寫測試程式，來一步一步建構出我們的系統，其倡導的概念為，先撰寫測試程式，再撰寫實際相對應的 function，因此程式開發者需要先行和 PM 或使用者討論系統需求，並逐步擬定測試計畫，最後才會真正開始撰寫程式 採用 TDD 開發的優缺點    好處 壞處    無須事後再補寫測試程式 若系統需求溝通不良，會容易造成系統設計不良   每一位 RD 都可以透過測試程式了解每個 function 的內容，較容易熟悉系統 測試程式有很大的機率只有 RD 部門看得懂，需要花費多於成本溝通   可以確保每個 function 被更動時，可以馬上進行測試，降低錯誤產生    3A 原則在 TDD 當中，對於每個測試程式的撰寫有著 3A 原則 (步驟)，分別為 Arrange、Act 以及 Assert，下面按照順序來進行說明 下面這段程式碼是我們在 demo 3A...</div></div></div></a><a class="pagination-related" href="/2023/09/21/Python-%E8%88%87%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6/" title="Python 與自動化測試"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-21</div><div class="info-item-2">Python 與自動化測試</div></div><div class="info-2"><div class="info-item-1">前言這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 主題   主題 日程    簡介 day 01   Pytest day 02 ~ 10   TDD day 11 ~ 12   Selenium day 13 ~ 17   Appium day 18 ~ 21   CI&#x2F;CD day 22 ~ 26   Jenkins day 27 ~ 29   結語 day 30   PytestPytest 是一種使用在 Python 語言裡面的一中單元測試框架，而 Pytest 基本上就是由 Python 原生自帶的單元測試框架 Unittest 衍生出來的，所以可以看到有些範例可以和 Unittest 的套件互相兼容混用。 Pytest 和 Unittest 相比，有下列幾項優點：  更易於上手，撰寫 testcase 時較為直覺 擴展性高，可以兼容許多外掛套件 可以標註某些 testcase 為失敗是正常的 測試程式撰寫起來相較於 unittest 較為簡潔  TDDTDD 完整名稱為 Test-driven development，中譯為...</div></div></div></a><a class="pagination-related" href="/2023/10/03/Selenium-%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6/" title="Selenium 自動化測試"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-03</div><div class="info-item-2">Selenium 自動化測試</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 套件安裝selenium：用來建立模擬器webdriver_manager：用來協助我們做驅動程式的安裝，可以無需實際下載瀏覽器的驅動程式 12pip install seleniumpip install webdriver_manager  快速入門程式解析： 透過 make_webdriver 內的程式碼，可以建立一個 Chrome 物件，習慣上我們會將此物件命名為 driver透過實作該方法得到 driver透過 driver.get() 對網址進行請求，這個時候 driver 就會實際替我們開啟一個瀏覽器為了展示開啟成功，使用 time.sleep() 讓瀏覽器畫面停止一下使用 driver.quit() 來確保瀏覽器完全關閉，不會殘留在記憶體當中 12345678910111213141516171819import timefrom selenium.webdriver import Chromefrom webdriver_manager.chrome import...</div></div></div></a><a class="pagination-related" href="/2023/10/27/Pytest-%E5%AE%A2%E8%A3%BD%E5%8C%96/" title="Pytest 客製化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-27</div><div class="info-item-2">Pytest 客製化</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 透過設定 pytest.ini 即可讓我們進行一些簡單的客製化，讓 pytest 更符合我們的需求 預設指令透過設定 pytest.ini 我們可以達到每次執行 pytest 時，會自動帶入指定的參數，例如：-s、-v …於整個專案最外層建立 pytest.ini 檔案 編輯 pytest.ini 1234[pytest]addopts = --maxfail=1 -s -v  範例當中，我們設定了在使用 pytest 時會自動帶入 -s、-v 參數，並且設定當發生一次錯誤時就會停止測試 建立測試程式 12345678import pytestargvalues = [[1, 1, 2], [2, 2, 5], [3, 3, 7], [4, 4, 8]]@pytest.mark.parametrize(argnames=&#x27;num1, num2, result&#x27;, argvalues=argvalues)def test_add(num1: int, num2: int, result:...</div></div></div></a><a class="pagination-related" href="/2023/10/25/%E8%87%AA%E5%8B%95%E5%8C%96%E6%B8%AC%E8%A9%A6-CI-CD/" title="自動化測試 CI&#x2F;CD"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-25</div><div class="info-item-2">自動化測試 CI&#x2F;CD</div></div><div class="info-2"><div class="info-item-1">這篇是記錄我在看鐵人賽 Python 與自動化測試的敲門磚  的過程 CI&#x2F;CD 簡介CI&#x2F;CD 其實是指兩個部分，分別是 Continuous Integration (持續整合) 以及 Continuous Deployment (持續部屬) CI 持續整合在軟體開發的過程中，通常會由無數個開發人員一起工作，然而隨著程式碼以及人數的增加，專案會越來越難進行整合，這個時候我們就可以透過 CI 來進行。與其說 CI 是個工具，不如說 CI 是一種合作模式，藉由簡單的設定來讓 CI 工具替我們進行測試，就可以降低我們的專案在進行更新、整合時碰到問題的機率。 在 CI 執行的過程中，會建議每個開發人員每天上班前先做一次 pull 的動作，於每天下班前至少執行一次 push 的動作，以此確保 CI 的運行效率。 CD 持續部屬每當我們透過 CI 將專案整合完成後，便可以透過 CD 來進行自動化的部屬，減少我們在測試與部屬之間所耗費的時間 CI&#x2F;CD 常用工具GitLab於 GitLab 上提供了 CI&#x2F;CD 的介面，藉由在某處部屬好的...</div></div></div></a><a class="pagination-related" href="/2023/11/27/Python-%E7%B6%B2%E9%A0%81%E6%9C%8D%E5%8B%99%E9%96%8B%E7%99%BC%E7%9A%84-UX-%E8%88%87-DX-%E6%AF%94%E8%BC%83/" title="Python 網頁服務開發的 UX 與 DX 比較"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-27</div><div class="info-item-2">Python 網頁服務開發的 UX 與 DX 比較</div></div><div class="info-2"><div class="info-item-1">這篇文章是我在 Agoda Engineering 部落格的文章閱讀紀錄UX vs. DX in Python Web Servers UX vs. DX in Python Web ServersAgoda在11月舉辦了一場與曼谷Python社群合作的ThaiPy聚會。演講者是Agoda的高級軟體工程師Mohamad Kamar，他分享了有關“Python Web伺服器中的UX vs DX”的演講。他深入探討了Python在Web伺服器架構方面的多樣性，從簡單的同步伺服器到複雜的異步和基於框架的伺服器。這篇博客文章總結了演講中討論的要點。 什麼是 UX and DX...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 評論</span></div><div class="comment-switch"><span class="first-comment">Valine</span><span id="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/catchorange.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Nalson Lai</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">111</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">184</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/gahgah147"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/gahgah147" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">在哪裡跌倒<br>就在哪裡躺好</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Pytest-%E6%8C%87%E4%BB%A4"><span class="toc-number">1.</span> <span class="toc-text">Pytest 指令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%83%E6%95%B8%E5%9F%B7%E8%A1%8C"><span class="toc-number">1.1.</span> <span class="toc-text">參數執行</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A2%E7%94%9F%E5%A0%B1%E8%A1%A8"><span class="toc-number">2.</span> <span class="toc-text">產生報表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A2%E5%87%BA-JSON-%E6%A0%BC%E5%BC%8F%E5%A0%B1%E8%A1%A8"><span class="toc-number">2.1.</span> <span class="toc-text">產出 JSON 格式報表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-pytest-json-report-%E5%A5%97%E4%BB%B6"><span class="toc-number">2.1.1.</span> <span class="toc-text">安裝 pytest-json-report 套件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">套件使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%B1%E8%A1%A8%E7%B5%90%E6%9E%9C%E8%A7%A3%E6%9E%90"><span class="toc-number">2.1.3.</span> <span class="toc-text">報表結果解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A2%E5%87%BA-HTML-%E5%A0%B1%E8%A1%A8"><span class="toc-number">2.2.</span> <span class="toc-text">產出 HTML 報表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-pytest-html-%E5%A5%97%E4%BB%B6"><span class="toc-number">2.2.1.</span> <span class="toc-text">安裝 pytest-html 套件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E4%BB%B6%E4%BD%BF%E7%94%A8-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">套件使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Allure"><span class="toc-number">2.3.</span> <span class="toc-text">Allure</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-Java-JDK"><span class="toc-number">2.3.1.</span> <span class="toc-text">安裝 Java JDK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-Allure"><span class="toc-number">2.3.2.</span> <span class="toc-text">安裝 Allure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D%E5%A5%97%E4%BB%B6"><span class="toc-number">2.3.3.</span> <span class="toc-text">安裝套件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%B7%E8%A1%8C%E6%B8%AC%E8%A9%A6%E8%88%87%E7%94%9F%E6%88%90%E5%A0%B1%E8%A1%A8"><span class="toc-number">2.3.4.</span> <span class="toc-text">執行測試與生成報表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8docker-compose%E5%9C%A8docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E9%81%8B%E8%A1%8Cpytest"><span class="toc-number">2.3.5.</span> <span class="toc-text">使用docker-compose在docker容器中運行pytest</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A"><span class="toc-number">3.</span> <span class="toc-text">環境設定</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#setup%E3%80%81teardown"><span class="toc-number">3.1.</span> <span class="toc-text">setup、teardown</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-env-%E6%AA%94%E6%A1%88"><span class="toc-number">3.1.1.</span> <span class="toc-text">建立 .env 檔案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D%E5%A5%97%E4%BB%B6-1"><span class="toc-number">3.1.2.</span> <span class="toc-text">安裝套件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%B0%E5%AF%AB%E6%B8%AC%E8%A9%A6%E7%92%B0%E5%A2%83"><span class="toc-number">3.1.3.</span> <span class="toc-text">撰寫測試環境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fixture"><span class="toc-number">3.2.</span> <span class="toc-text">fixture</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E9%8C%84%E6%9E%B6%E6%A7%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">目錄架構</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B-fixtures-py-%E6%AA%94%E6%A1%88"><span class="toc-number">3.2.2.</span> <span class="toc-text">快速建立 fixtures.py 檔案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fixture-%E8%A3%9D%E9%A3%BE%E5%99%A8%E5%8F%83%E6%95%B8%E4%BB%8B%E7%B4%B9"><span class="toc-number">3.2.3.</span> <span class="toc-text">fixture 裝飾器參數介紹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BC%8F%E8%A7%A3%E9%87%8B"><span class="toc-number">3.2.4.</span> <span class="toc-text">程式解釋</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-fixture"><span class="toc-number">3.2.5.</span> <span class="toc-text">使用 fixture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fixture-%E4%BD%BF%E7%94%A8%E6%99%82%E6%A9%9F"><span class="toc-number">3.2.6.</span> <span class="toc-text">fixture 使用時機</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9B%E6%93%AC%E8%B3%87%E6%96%99%E5%BA%AB"><span class="toc-number">4.</span> <span class="toc-text">虛擬資料庫</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9B%E6%93%AC%E9%97%9C%E8%81%AF%E5%BC%8F%E8%B3%87%E6%96%99%E5%BA%AB-SQLite"><span class="toc-number">4.1.</span> <span class="toc-text">虛擬關聯式資料庫 SQLite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%88%E6%A1%88%E6%9E%B6%E6%A7%8B%E4%BB%8B%E7%B4%B9"><span class="toc-number">4.1.1.</span> <span class="toc-text">專案架構介紹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B3%87%E6%96%99%E5%BA%AB%E8%B7%AF%E5%BE%91"><span class="toc-number">4.1.2.</span> <span class="toc-text">資料庫路徑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%B8%AC%E8%A9%A6%E5%85%A7%E5%AE%B9"><span class="toc-number">4.1.3.</span> <span class="toc-text">建立測試內容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-fixture"><span class="toc-number">4.1.4.</span> <span class="toc-text">建立 fixture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%B8%AC%E8%A9%A6%E7%A8%8B%E5%BC%8F"><span class="toc-number">4.1.5.</span> <span class="toc-text">建立測試程式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">4.1.6.</span> <span class="toc-text">成果展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSQL-%E9%99%A3%E7%87%9F%E7%9A%84%E8%99%9B%E6%93%AC%E8%B3%87%E6%96%99%E5%BA%AB%E5%A5%97%E4%BB%B6-MongoMock"><span class="toc-number">4.2.</span> <span class="toc-text">NoSQL 陣營的虛擬資料庫套件 - MongoMock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E4%BB%B6%E5%AE%89%E8%A3%9D"><span class="toc-number">4.2.1.</span> <span class="toc-text">套件安裝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-crud"><span class="toc-number">4.2.2.</span> <span class="toc-text">建立 crud</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-fixtures"><span class="toc-number">4.2.3.</span> <span class="toc-text">建立 fixtures</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test-case-%E5%BB%BA%E7%AB%8B"><span class="toc-number">4.2.4.</span> <span class="toc-text">test case 建立</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A9%97%E8%AD%89%E9%8C%AF%E8%AA%A4%E8%88%87%E8%B7%B3%E9%81%8E%E6%A1%88%E4%BE%8B"><span class="toc-number">5.</span> <span class="toc-text">驗證錯誤與跳過案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A9%97%E8%AD%89%E9%8C%AF%E8%AA%A4"><span class="toc-number">5.1.</span> <span class="toc-text">驗證錯誤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%97%E8%AD%89%E9%8C%AF%E8%AA%A4%E8%A8%8A%E6%81%AF"><span class="toc-number">5.1.1.</span> <span class="toc-text">驗證錯誤訊息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%B3%E9%81%8E-test-case"><span class="toc-number">5.1.2.</span> <span class="toc-text">跳過 test case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E8%B7%B3%E9%81%8E-skip"><span class="toc-number">5.1.3.</span> <span class="toc-text">直接跳過 skip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%A2%9D%E4%BB%B6%E8%B7%B3%E9%81%8E-skipif"><span class="toc-number">5.1.4.</span> <span class="toc-text">有條件跳過 skipif</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#parametrize-%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E5%A4%9A%E7%AD%86%E6%B8%AC%E8%A9%A6"><span class="toc-number">6.</span> <span class="toc-text">parametrize 自動生成多筆測試</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B0%A1%E5%96%AE%E7%AF%84%E4%BE%8B"><span class="toc-number">6.1.</span> <span class="toc-text">簡單範例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E9%85%8D%E6%AA%94%E6%A1%88%E8%AE%80%E5%8F%96"><span class="toc-number">6.2.</span> <span class="toc-text">搭配檔案讀取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ids-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.3.</span> <span class="toc-text">ids 的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E9%85%8D-fixture-%E5%81%9A%E4%BD%BF%E7%94%A8"><span class="toc-number">6.4.</span> <span class="toc-text">搭配 fixture 做使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#conftest-py"><span class="toc-number">7.</span> <span class="toc-text">conftest.py</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#conftest-py-%E7%B0%A1%E4%BB%8B"><span class="toc-number">7.1.</span> <span class="toc-text">conftest.py 簡介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%E5%B1%95%E7%A4%BA"><span class="toc-number">7.2.</span> <span class="toc-text">範例展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-conftest-py"><span class="toc-number">7.2.1.</span> <span class="toc-text">建立 conftest.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-json-%E6%AA%94%E7%94%A8%E4%BE%86%E6%8E%A7%E5%88%B6%E6%AC%8A%E9%99%90"><span class="toc-number">7.2.2.</span> <span class="toc-text">建立 json 檔用來控制權限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%B0%E5%AF%AB-test-case"><span class="toc-number">7.2.3.</span> <span class="toc-text">撰寫 test case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B5%90%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">7.2.4.</span> <span class="toc-text">結果展示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%8F%E9%A1%8C%E6%8E%92%E9%99%A4"><span class="toc-number">8.</span> <span class="toc-text">問題排除</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#chrome-driver%E7%89%88%E6%9C%AC%E9%81%8E%E8%88%8A"><span class="toc-number">8.1.</span> <span class="toc-text">chrome driver版本過舊</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/24/%E5%A6%82%E4%BD%95%E5%9C%A8-TailwindCSS-%E4%B8%AD%E9%9A%B1%E8%97%8F%E6%8D%B2%E8%BB%B8-scrollbar/" title="如何在 TailwindCSS 中隱藏捲軸 - scrollbar">如何在 TailwindCSS 中隱藏捲軸 - scrollbar</a><time datetime="2024-12-24T01:56:08.000Z" title="發表於 2024-12-24 09:56:08">2024-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/20/Leetcode-%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84-SQL-50-550-Game-Play-Analysis-IV/" title="Leetcode 解題紀錄 SQL 50 - 550. Game Play Analysis IV"><img src="https://hackmd.io/_uploads/B1DiYYzSyg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Leetcode 解題紀錄 SQL 50 - 550. Game Play Analysis IV"/></a><div class="content"><a class="title" href="/2024/12/20/Leetcode-%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84-SQL-50-550-Game-Play-Analysis-IV/" title="Leetcode 解題紀錄 SQL 50 - 550. Game Play Analysis IV">Leetcode 解題紀錄 SQL 50 - 550. Game Play Analysis IV</a><time datetime="2024-12-20T07:35:33.000Z" title="發表於 2024-12-20 15:35:33">2024-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/12/Auth-js-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%B4%B9%E8%88%87%E5%AE%89%E8%A3%9D%E6%B5%81%E7%A8%8B/" title="Auth.js 功能介紹與安裝流程"><img src="https://hackmd.io/_uploads/H1F7KnPVke.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Auth.js 功能介紹與安裝流程"/></a><div class="content"><a class="title" href="/2024/12/12/Auth-js-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%B4%B9%E8%88%87%E5%AE%89%E8%A3%9D%E6%B5%81%E7%A8%8B/" title="Auth.js 功能介紹與安裝流程">Auth.js 功能介紹與安裝流程</a><time datetime="2024-12-12T01:32:21.000Z" title="發表於 2024-12-12 09:32:21">2024-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/03/%E8%81%AF%E7%9B%9F%E6%88%B0%E6%A3%8BS13%E8%BF%BD%E5%B0%8B%E5%A5%A7%E8%A1%93%E8%B3%BD%E5%AD%A3%E9%99%A3%E5%AE%B9%E5%88%86%E4%BA%AB-%E9%BB%91%E7%8E%AB%E7%91%B0%E5%BE%81%E6%9C%8D%E8%80%85/" title="TFT聯盟戰棋S13追尋奧術賽季陣容分享 - 黑玫瑰征服者"><img src="https://hackmd.io/_uploads/By4hxCYQyg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TFT聯盟戰棋S13追尋奧術賽季陣容分享 - 黑玫瑰征服者"/></a><div class="content"><a class="title" href="/2024/12/03/%E8%81%AF%E7%9B%9F%E6%88%B0%E6%A3%8BS13%E8%BF%BD%E5%B0%8B%E5%A5%A7%E8%A1%93%E8%B3%BD%E5%AD%A3%E9%99%A3%E5%AE%B9%E5%88%86%E4%BA%AB-%E9%BB%91%E7%8E%AB%E7%91%B0%E5%BE%81%E6%9C%8D%E8%80%85/" title="TFT聯盟戰棋S13追尋奧術賽季陣容分享 - 黑玫瑰征服者">TFT聯盟戰棋S13追尋奧術賽季陣容分享 - 黑玫瑰征服者</a><time datetime="2024-12-03T01:30:56.000Z" title="發表於 2024-12-03 09:30:56">2024-12-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/29/PM2%EF%BC%9A%E6%8F%90%E5%8D%87-Node-js-%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F%E7%AE%A1%E7%90%86%E8%88%87%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%A9%E5%99%A8/" title="PM2：提升 Node.js 應用程式管理與性能的利器"><img src="https://hackmd.io/_uploads/HJH6Jzwmke.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PM2：提升 Node.js 應用程式管理與性能的利器"/></a><div class="content"><a class="title" href="/2024/11/29/PM2%EF%BC%9A%E6%8F%90%E5%8D%87-Node-js-%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F%E7%AE%A1%E7%90%86%E8%88%87%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%A9%E5%99%A8/" title="PM2：提升 Node.js 應用程式管理與性能的利器">PM2：提升 Node.js 應用程式管理與性能的利器</a><time datetime="2024-11-29T09:58:06.000Z" title="發表於 2024-11-29 17:58:06">2024-11-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Nalson Lai</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主題 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日夜模式切換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往評論"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到頂端"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.1.0"></script><script src="/js/main.js?v=5.1.0"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.3.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine@1.5.2/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><script>(() => {
  const disqus_config = function () {
    this.page.url = 'https://gahgah147.github.io/2023/09/22/Pytest-%E8%87%AA%E5%8B%95%E6%B8%AC%E8%A9%A6/'
    this.page.identifier = '/2023/09/22/Pytest-%E8%87%AA%E5%8B%95%E6%B8%AC%E8%A9%A6/'
    this.page.title = 'Pytest 自動測試'
  }

  const disqusReset = () => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addGlobalFn('themeChange', disqusReset, 'disqus')

  const loadDisqus = () =>{
    if (window.DISQUS) disqusReset()
    else {
      const script = document.createElement('script')
      script.src = 'https://.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if ('Valine' === 'Disqus' || !true) {
    if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      GLOBAL_CONFIG_SITE.isPost && getCount()
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜尋</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  資料載入中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜尋文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.1.0"></script></div></div></body></html>